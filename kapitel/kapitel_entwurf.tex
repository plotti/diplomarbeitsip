\chapter{Entwurf}


My focus:
Audio management that restricts the use of the audio channel, including explicit and implicit floor control , and control actions like push to talk. 


\section{Soll - Kommunikationsaspekte}

\subsection{Kommunikationsmodell}

Was bedeutet das Kommunikationsmodell für unseren Entwurf?
Da der Hauptaspekt der Arbeit die Herstellung einer Sprachkommunikation besteht, sollte diese auch entsprechend der Modelierung im Ersten Kapitel erfolgen. Was dabei relevant ist, ist das das klassische Kommmunikationsmodell von Shannon und Weaver \cite{shannon48} um die kritische Komponente des Feedbacks \cite{schramm54} unbedingt zu erweitern ist. So soll die Modellierung der Sprachkommunikation darauf ausgerichtet sein, dass auftretende Probleme entsprechend des Modells minimiert werden können. Es muss gewährleistet werden dass das technische Problem der KOmmunikation gelöst wird und das Semantische und Effiktivitätsproblem minimiert werden. Im Konkreten bedeutet es, dass die Kommunikation über ein verlässtliches Netzwerk stattfinden muss und der Teilnehmer in der Lage sein muss zu entscheiden an mit wem seine Kommunikation stattfindet als auch in der Lage sein muss jederzeit auf Ereignisse spontan zu reagieren. Im erweiterten Modell soll der Teilnehmer in der Lage sein die Komponente des des Feedbacks zu kontrollieren, in dem er bei der Kommunikation jederzeit in der Lage ist ein Feedback zu geben und zu wissen an wen er das Feedback gerade gibt. Dabei soll zusätzlich die Verzögerung zwischen der Nachricht und Feedback minimiert werden. 

\subsection{Interpersonelle vs. Massenkommunikation}
Da wor Kommunikationen ermöglichen wollen bei denen mindestens zwei Kommunizierende beabsichtigt miteinander kommunizieren können, aber auch ermöglichen wollen dass ein Sprecher an mehrere Empfänger kommunizieren kann, bedeutet es im theoretischen Ansatz, dass wir sowohl die interpersonelle Kommnikation als auch die Massenkommunikation ermöglichen wollen. Obwohl diese Soll-Forderung trivial erscheint verfügen wenige der existierenden Sprachkommunikationslösungen über beide Ansätze. So ist es entweder möglich, dass alle Teilnehmer der Kommunikation auf einem gemeinsamen Kanal kommunizieren, das einer Massenkommunikation gleichkommt, was eine interpersonelle Kommunikation auf diesem Kanal ausschließt oder es ist möglich dass zwei Partner in einem interpersonellen Telefongespräch miteinander Kommunizieren, welches sie jedoch die Kommunikation auf genau diese zwei Teilnehmer begrenzt. 
%TODO BILD DER Interpersonellen und Massenkommunikation

\subsection{Interaktivität und Lebhaftigkeit}

Wenn wir von Interaktivität und Lebhaftigkeit sprechen meinen wir, dass wir bestimte Anforderungen an die Sprachkommunikation stellen, so soll wie schon oben formuliert das Feedback möglichst unmittelbar geschehen, die Kommunikation sowohl persönlich als auch mit mehreren Teilnehmern möglich sein und das gewählte Medium unsere Bemühungen möglichst gut unterstützen. Im Media Richness Modell \cite{reichswald98} bedeutet es dass wir eine komplexe Telekooperationsaufgabe lösen wollen, nämlich mit einer vielzahl an Teilnehmern ein Spiel mit komplexen Anforderungen in Bezug auf die Gruppendynamik und das Timing zu spielen. Dieses erfordert ein Medium dass in der Lage ist diese Aufgaben zu lösen während wir jedoch die Spieler selbst mit zu vielfältigen Möglichkeiten vor einer Überkomplizierung durch das Medium schützen wollen. Was es konkret bedeutet ist dass wir die Verwendung des Mediums so gestalten wollen, dass es einerseits ein Werkzeug ist, das den Teilnehmern eine bessere Koordination ermöglicht. 
%TODO BIld einer "`klassischen Sprachkommunikation mit Konfigurationen"'

\subsection{Proxemik in der Kommunikation}
Da wir die nonverbale Kommunikation als essentiellen Teil der Kommunikation verstehen, und der Meinung sind dass eine Sprachkommunikation gerade durch ihren nonverbalen Anteil erst ihre volle Semantik entfalten kann sollen diese Aspekte direkt in den Ansatz einer Sprachkommunikation integriert werden. Speziell bedeuetet es für uns dass im Spiel selbst der Raum in drei Distanzzonen eingeteilt werden sollte in denen verschiedene Ausprägungen der Sprachkommunikation möglich sein sollen. 
Wir schlagen angelehnt an die Forschung von \cite{hall05} vor den Raum ebenfalls in drei Distanzzonen zu unterteilen:
\begin{itemize}
	\item Intime Distanz: Hier sollen die Spieler in der Lage sein frei miteinader interpersonell zu kommunizieren. Vorstellbar sind zwei Alternativen indem eine Kommunikation auf dieser Distanzzone entweder nur zwischen 2 Personen möglich ist und von anderen nicht mitgehört werden kann, oder auch eine relaxierte Version in der die die Lautstärke der Kommunikation in dieser Distanzzone konstant gut hörbar bleibt.
	\item Soziale Distanz: Hier sollen die Spieler in der Lage sein sich gegenseitig zu hören, dabei soll die direkte Enfernung untereinander Einfluss auf die wahrgenommene Lautstärke haben. 
	So sollen Spieler die sich näher befinden Lauter sein, während Spieler die sich weiter entfernt befinden leiser sein. Dabei soll die Lautstärke linear abnehmen bis Spieler die öffentliche Distanz errreichen.
	\item Öffentliche Distanz: In der Öffentlichen Distanz ist zunächst keine weitere Sprachkommunikation möglich. Das einzige Mittel der Kommunikation bleibt hier die Textkommunikation die jederzeit und an jeden Spieler übertragen wird, deshalb auch einen öffentlichen Charakter besitzt. Trotzdem soll in der öffentlichen Zone der unmittelbare übergang zur Sozialen Zone störungsfrei ablaufen und keine Verzögerungen aufweisen. Hier wird die Sprachkommunikation bereits vorbereitet, da der ein stetiger Wechsel zwischen der öffentlichen zur sozialen Zone vermutet wird. 
\end{itemize}
%TODO BILD DER ZONEN

\subsection{Positionierung des Prototyps}

Eine in Kapitel 1 vorgestellte klassische Unterteilung von Spielen in Spielegenre zeigt, dass in Abhängigkeit vom Genre des Spiels der Kommunikationsaspekt unterschiedlich stark ausgeprägt ist. So besitzen Actionspiele und Rollenspiele meist den größten Bedarf nach einer ausgeprägten Sprachkommunikation, da stets mehrere Spieler miteinander konkurrieren oder kollaborieren.
Beide Genre haben gemeinsam dass der Spieler in detaillierten realistischen virtuellen 3D Welten mittels einer Spielfigur navigieren, die mit anderen Spielfiguren in Interaktion treten kann.
Dabei entsteht der Spielspaß gerade in der Interaktion welche entweder als Zusammenarbeit oder Kampf verstanden werden kann. In Actionspielen wird durch dem Beschuss mit Projektilen eine Interaktion ausgeübt, die zu einer Konkurenz führt in der der schnellste und geschickteste Spieler das Spiel gewinnt. Finden sich die Spieler in Spielergruppen zusammen so entscheidet nicht mehr die Leistung des einzelen Über den Sieg des Teams. Ein ähnliches Phänomen lässt sich in Rollenspielen beobachten in denen Spieler mittels Zaubersprüchen oder anderen Artefakten miteinander interagieren. Hier entscheidet oft nur die Kollaboration der Spieler der gleichen Spielergruppe über den Spielausgang. Können Mitspieler ihre Aktionen besonders gut aufeinander abstimmen um Vor und Nachteile der einzelenen Spieler zu kompensieren sind sie oft von Erfolg gekrönt. Beide Genre Bedürfen einer ausgeklügelten Kommunikation und Interaktion zwischen den einezelnen Teilnehmern. 
 Angehnt an das System das Gibs, Wadley und Benda im ersten Kapitel vorstellen wollen wir den Prototypen im einem Viereck aus Spielerlebniss, Spielsimulation, erzählerischem Aspekt und der Spielerinteraktion einordnen. Die oben genannten Vertreter der Actionspiele Genre sowie der Rollenspielegenre unterscheiden sich zwar im erzählerischen Aspekt, der bei Rollenspielen dominierend ist, während bei Actionspielen das Spielerelbniss domiert, haben aber beide eine hohe Spielerinteraktion und Simulationstiefe.   
	Obwohl der Prototyp weder ein ausgereiftes Action oder Rollenspiel ist, da diese die Zielvorgaben der Arbeit sprengen würde, soll er deren gemeinsamen Aspekt der Spielerinteraktion betonen. 
 
 %BILD der Einordnung des Spiels.
 %BILD der Einordnung eines Actionspiels
 %Bild der Einordnung eines Rollenspiels

Dabei sollen Aspekte des Spielererlebniss, und des erzählerischen Aspekts vernachlässigt werden, jedoch Aspekte der Simulation und Spielerinteraktion betont werden. 

\subsection{Folgerungen aus den Studien der Textkommunikation}
Studien der Textkommunikation aus Kapitel 1 lassen uns folgende Schlüsse in Bezug auf den Prototypen ziehen. 
Textkommunikation enthält außer der ursprünglichen Nachricht viele Akronyme und Emoticons die nur unzulänglich die soziale Komponente einer Kommunikation widerspiegeln können und ist für durch die Nutzung von eines einzigen gemeinsamen öffentliche Kommunikationskanäle einfach nicht für eine interpersonelle Kommunikation tauglich. Zusätzlich wird durch den Einsatz von Abkürzungen, fehlerhafter Gramatik und Semantik, soziale Kommunikation erschwert. Dabei besteht gerade für diese überproportionaler Bedarf wie Studien festgestellt haben. Die Vermutung liegt nahe, dass die Spieler die Handicaps der Textkommunikation zwar teilweise erfolgreich durch verschiedene Methoden behoben haben, trotzdem der Wunsch nach einem Medium, das besser ohne Einschränkungen in der Lage ist Nachrichten sozialer Natur zu übertragen nach wie vor vorhanden ist.
Dies lässt die Schlussfolgerung zu dass Textkommunikation in Spielen nur teilweise effizient einsetzbar ist und bestätigt die Bemühungen nach einem kommunikations Prototypen, der in der Lage ist oben genannte Misstände zu kompensieren.

\subsection{Folgerungen aus den Studien der Nonverbalen Kommunikation}
Studien der Nonverbalen Kommunikation aus Kapitel 1 lassen uns folgende Schlüsse in Bezug auf den Prototypen ziehen.
Ist man in der Lage eine Nonverbale Kommunikation zuzulassen so ergeben sich viele Vorteile die direkten Einfluss auf die Effektivität der Kommunikation zulassen. So kann einzig die Entfernung der Teilnehmer voneinander entscheiden ob eine interpersonelle oder Massenkommunikation wünscht. Durch einfaches Kopfnicken lassen sich Verständniss oder Unverständniss des gerade gehörten in der einfachsten Form signalisieren. Nonverbale kommunikation trägt nicht nur zur Erhöhung der Interaktivität und Lebhaftigkeit bei sondern bildet die einfachste und intuitivste Form der Verwaltung einer Konferenz. Obwohl die Steuerung von Konferenzen seit Jahren erforscht wird existieren bisher wenige Intuitive Methoden. Für unseren Prototyp bedeutet es dass unsere Position in einer 3D Welt Teilnehmers völlig intuitiv den Fluss der Kommunikation steuert. 

\subsection{Sprachkommunikation}
Aus der psychologischen Sicht sind die Studien zur Sprachkommunikation ein zentraler Ansatzpunkt für die Entwicklung des Prototypen. 
Was zunächst festzuhalten ist, ist der Fakt das eine Sprachkommunikation in allen Ausprägungen die Lebhaftigkeit  und die soziale Erfahrung beim Spielen steigert. Jedoch zeigen die Studien dass Sprachkommunikation in Computerspielen sich nicht so einfach umsetzen lässt wie sie von uns im realen Leben eingesetzt wird. Es lassen sich mehrere Probemkategorien ableiten:

\subsubsection{Probleme der Sprachkommunikation}

\begin{itemize}

	\item Limitierter Kanal: Vor allem durch die Beschränkte Nutzung eines einzigen Kanals der durch alle Spieler genutzt wurde, nutzten Teilnehmer diesen Kanal zur reinen Aufgabenorientieren koordinierung des Teams. Der gewünschte soziale Aspekt der Kommunikation dagegen blieb üver weite Strecken vollständig aus. 
	
	\item Geringe Audioqualität: Durch eine geringe Audioqualität, hohe Stö
rgeräusche und Latenzen waren Spieler nicht in der Lage erfolgreich miteinander zu kommunizieren.
Eine mögliche Lösung wäre wenn der Spieler in der Lage IST problematische Audioquellen, die mit Störungen behaftet sind zu meiden. 

	\item Keine Kontrolle über Empfänger der Nachricht: Studien haben festgestellt dass das triviale Problem mit wem man gerade spricht bisher nicht sauber gelöst wurde. Dadurch dass Spieler sich einen Kanal teilen ist eine direkte Adressierung nicht möglich. 
	
	\item Keine Kontrolle über Empfang der Nachrichten: Analog dazu waren Spieler genauso wenig in der Lage zu Kontrollieren, welche Sprachnachrichten sie empfangen möchten. Oft führte dies dazu dass ein Großteil der Sprachkommunikation auf den Kanälen als Lärm Emfpunden wird. 
\end{itemize}

\subsubsection{Anforderungen an den Prototypen}
Viele der oben genannten Probleme beruhen auf dem Prinzip der Verwendung von Kanälen zur Kommunikation, die von mehreren Spielern geteilt werden müssen. Für den Prototypen bedeutet es, dass wir statt eines Einkanal Systems eine Kommunikationslösung brauchen, die in der Lage ist mehrere gleichzeitig Gespräche zu ermöglichen ohne dass sie Spieler gegenseitig bei ihren Übertragungen stören. Zusätzlich soll nicht nur mehrere 1:1 Verbindungen möglich sein, sondern auch eine 1:N Adressierung existieren. 
Prinzipiell erfordert die Einführung von mehreren Kanälen ein entsprechend kompliziertes Management dieser, da Spieler in der Lage sein sollen zu entscheiden was sie hören wollen und was nicht. Die Lösung besteht aus der Relaxierung des Problems zu einem Nachbarschaftsproblem indem Spieler durch ihre Distanz zueinander entscheiden können welche Kanäle sie hören möchten und welche nicht. Dieses Thema birgt zunächst ein Problem, dass ein Spieler nicht alle Kanäle abonnieren kann die er möchte, da dies bedeuten würde dass sich diese Personen immer in seiner Umgebung befinden müssten. Doch was auf den ersten Blick als Nachteil erscheint, kann auch als signifikanter Vorteil gesehen werden. Da bereits festgestellt wurde, dass durch eine Überlagerung zu viele gleichzeitig empfangener Audioströme diese vom Spieler als Lärm wahrgenommen wird, ist eine mögliche Lösung die Begrenzung der Teilnahme an mehreren Kanälen, indem man nunmal nicht in jedermans Nähe gleichzeitig sein kann.


\section{Wahl der Grafik und Audio Engine}

\subsection{3D Spieleengines}
Die Entwicklung eines realistisches Spieles geht weit über das Thema der Arbeit hinaus, da diese Aufgabe normalerweise von ganzen Teams über mehrere Monate oder Jahre bewältigt wird. Deswegen fiel die Entscheidung auf eine bestehendes SpieleFramework. Ziel des Prototyps war es einen Avatar in einer 3D möglichst realistischen Umgebung zu steuern. 
Viele der bestehenden Spiele Frameworks für 3D orientierte Spiele existieren meist auf der Enwicklungsgrundlage großer Softwarestudios wie Idsoftware\cite{idsof08} oder Epic Games \cite{unreal2008} die proprietäre Standards setzten indem sie, die den Quellcode ihrer erfolgreichsten Titel wie z.B. Quake II, Quake III sowie Unreal I Spieleframeworks offen anboten. Da es meist zum Ursus großer Entwicklerstudios gehöhrt, dass meist mit dem Aufkommen eines neuen kommerziellen Titels die Entwicklung eines neuen Spieleframeworks mit einher geht, existieren von den Haupvertretern großer Spiele Engines mehrere Generationen sowie Derrivate. 
Seit einigen Jahren sind mit dem vorranschreiten der Open Source Entwicklung auch komplette open source Neuentwicklungen wie Sauerbraten \cite{sauerbraten08} oder Nexuiz \cite{nexuiz08} entstanden, die auch speziell für das Ego-Shooter Genre entworfen wurden. Obwohl diese Spiele Engines sowohl opulente Grafik, ein ausgereiftes Spielprinzip sowie eine ausgereifte Steuerung bieten, ist die Modifikation der darunterliegenden Hauptbestandteile wie den Netzwerkkomponenten oder der Spielelogik teilweise nicht ausführlich Dokumentiert, mühsahm oder gar nicht vorgesehen. 

\subsection{3D Engines}
Eine Alternative zu Spiele Engines bieten offene generische 3-D Engines, deren Fokus nicht auf der kompletten Entwicklung eines speziellen Spiels liegt sondern ledeglich komfortabel ermöglicht 3D-Grafiken interaktiv darzustellen. Dazu werden meist die Details von Systembibliotheken wie Direct3D oder OpenGL abstrahiert und dem Entwickler ein Interface angeboten das auf höher abstrahierten Objects oder anderen Abstraktionsklassen basiert. Bekannte Vertreter sind Ogre3D \cite{ogre08} oder Irrlicht \cite{irrlicht08}. 

\subsubsection{Irrlicht}
Irrlicht ist eine einfache gut dokumentierte open source Engine in C++ die alle üblichen 3D Features als auch Collision Detection, Animationen, Texturen unterstützt und sowohl unter Windows, Linux als auch Mac OS verfügbar ist. Aufgrund der bestehenden Arbeit von \cite{triebel07g}, war es mir möglich bereits bestehende Konzepte zu verwenden und somit eine schnelle Entwicklung des Prototyps zu gewährleisten.

\subsubsection{Irrklang}
Speziell für die Sprachkommunikation musste die Engine um eine Sound-Engine erweitert werden die eine Audioausgabe ermöglicht. Da speziell für Irrlicht speziell eine plattformübergreifende Audiobibliothek irrKlang \cite{irrklang08} existiert, die einerseits low level Audio Verarbeitung als auch Streaming, realistisches 3D Audio Rendering, Multithreading und Plugins unterstützt gleichzeitig aber auch über eine einfache API verfügt, war die Entscheidung dieses Kombination zu verwenden nicht schwer. 

\section{Bestehende VoIP Anwendungen für Spiele}
Zwecks der Implementierung einer Sprachkommunikationslösung stehen mehrere Alternativen zur Verfügung. Dabei ist die Mehrzahl der Lösungen kommerzieller oder proprietärer Natur. Bisher werden im Spielebereich fast aussschließlich serverbasierte Sprachkommunikationslösungen eingesetzt. Dabei unterstützen viele der Lösungen ähnliche Audiocodecs und bieten einen vergleichbaren Funktionsumfang.
Im privaten VoIP Telefonie Bereich werden oft kommerzielle Produkte wie Skype eingesetzt.
Die wenigsten Benutzer setzen offene Sprachkommunikationslösungen ein. 

\subsection{Serverbasierte Sprachkommunikationslösungen}
%http://www.tentonhammer.com/index.php?q=node/102

\subsubsection{Ventrillo}
%http://www.ventrilo.com/
Die unter Spielern beliebteste Lösung Ventrillo (Version 3.0.1) ist eine serverbasiertes propriäteres VoIP Anwendung die eine Sprachkommunikation von Clients erlaubt. Die Software besteht aus einem Server- und Client-modul, wobei die Clientsoftware frei erhältlich ist, für die Serverkomponente jedoch eine kostenpflichtige Lizenz zu erwerben ist. Benutzer des Ventrillo Clients melden sich vor Beginn des eigentlichen Spieles auf einem der kostenpflichtigen Ventrillo Server an und können dort einen Kanal betreten. Benutzer des gleichen Kanals auf dem gleichen Server können gegenseitig gehört werden. Durch das Lizenzmodell ist es nicht möglich im privaten Bereich eigene Server zu betreiben und man ist auf bestehende Anbieter limitiert. 

\subsubsection{Teamspeak}
%http://www.goteamspeak.com
Teamspeak (Version 2.0.33.7) ist ebenfalls ein serverbasiertes propriäteres VoIP Programm das eine Sprachkommunikation von Clients erlaubt.Die Software besteht ebenfalls aus eine Server und Client Komponenten. Benutzer des kostenlosen Teamspeak Clients können sich mit dem kostenpflichtigem TeamSpeak Server ihrer Wahl verbinden und dort einen Kanal betreten. Benutzer des gleichen Kanals auf dem gleichen Server können gegenseitig gehört werden. Zusätzlich existieren Plugins die es erlauben Kanäle während der Spielesitzung per Tastaturkombination zu wechseln. 


\subsubsection{Mumble}
%http://mumble.sourceforge.net
Mumble (Version 1.1.3) ist eine offene serverbasierte VoIP Anwendung, die primär von Computerspielern für Sprachkommunikation genutzt wird. Mumble versucht die soziale Komponente der Sprachkommunikation zu betonen indem es sehr wenige Administrative Elemente besitzt und das Hauptaugenmerk auf der Sprachqualität liegt. Seine Verwendung gleicht den anderen Programmen indem Benutzer des Clients Kanäle auf Servern betreten um gegenseitig gehört zu werden. 

Obwohl die kommerziellen Lösungen bei einer optimalen Konfiguration hunderte von Benutzern unterstützen können und eine gute Sprachqualität bieten haben sie den Nachteil, dass sie nicht modifizierbar sind, die Serverkomponenten nicht frei verfügbar sind, und somit eine Nutzung den Prototypen nicht sinnvoll erscheint. 
Mumble als einziges ist wegen seiner offenen Lizenz modifizierbar, jedoch Aufgrund der komplizierten Serverkonfiguration und einem komplexen Rechtesystem, das auf Gruppen und Regeln basiert, nicht einfach für unsere Bedürfnisse anzupassen.
Zusätzlich zu den vorhandenen Problemen sind die drei propriäteren Lösungen untereinander nicht kompatibel und bieten somit nur Insellösungen. 

\subsection{Dezentralisierte Sprachkommunikationslösungen}

\subsubsection{Skype}

Das in Kapitel 2 bereits Skype erlaubt peer-to-peer VoIP. Obwohl der Einsatz Skype kostenlos ist und der Dienst völlig dezentralisiert ist bietet es auch einige Nachteile. 
Da Skypes VoIP-Protokoll proprietär ist, kann es nur mit der originalen Skype-Software genutzt werden. Über das Skype-API ist es auch für externe Programme möglich, auf die Funktionalitäten des Skype-Clients und Teilen des Netzwerkes zuzugreifen. Jedoch sind in der kostenlosen Version nur Konferenzen mit bis zu 5 gleichzeitigen Teilnehmern möglich. In einer kostenpflichtigen Version werden bis zu 10 gleichzeitige Konferenzteilnehmer unterstützt, die Clients bieten jedoch keine Kontrolle über die einzelenen Audioströme. So kann man nur die Summe aller Audioströme empfangen und kann die Lautstärke einzelner Teilnehmer nicht geändert werden oder einzelen Audioströme komplett stummgeschaltet werden. 
Somit bietet sich Skype als einziger tatsächlicher dezentralisierter Client nicht alle Eigenschaften um als mögliche Ausgangsgrundlage zu dienen. 


\subsection{Instant Messanging Anwendungen}
Andere peer-to-peer Programme wie Microsoft Netmeeting, Microsoft Messenger, GoogleTalk sind nicht modifizierbar und bieten nur keinerlei Konferenzmöglichkeiten. 

\subsection{SIP}

Das in Kapitel 2 vorgestellte SIP Protokoll erfüllt gleich mehrere Anforderungen an den Prototypen. Dadurch dass SIP ein sehr generisches offenes Protokoll ist kann es kann benutzt werden, um beliebige Sessions mit einem oder mehreren Teilnehmern zu verwalten. Dabei ist es nicht auf Internet-Telefonie beschränkt, sondern Sessions können beliebige Multimediaströme, Konferenzen, Computerspiele usw. sein.
Zahlreiche standardisierungs Organisationen wie IETF PINT, 3GPP, International Packet Communications Consortium, IMTC und PacketCable unterstützen bereits den Einsatz von SIP.
%http://www.cs.columbia.edu/sip/
In der open source Gemeinde wird das SIP Protokoll auch zunehmend unterstützt so existieren bereit etliche Clientanwendungen als auch zentrale Komponenten wie Proxys und Registrare, die der zunehmenden globalen Verbreitung von SIP dienen. Zusätzlich werden etliche SIP stacks, Client anwendungen und SDKs bishin zu Komplettlösungen angeboten die in Konkurenz zu kommerziellen Lösungen stehen. Es existieren auch Referenzimplementierungen, wie SIP JAIN-SIP, welches vom National Insitute of Standards and Technology (NIST) entwickelt wurde, die sowohl in kommerziellen Projekten aber auch zu Forschungszwecken eingesetzt werden. 

SIP erfüllt auch die Anforderungen an unseren Prototyp, indem wir in der Lage sind mehrere Audioströme zu verwalten, Kontrolle über die Audioströme zu haben und sowohl serverbasierte als auch dezentralisierte Lösungen umzusetzen. 

\cite{schulzrinne05} -- Peer-to-Peer SIP Assumptions

Um eine funktionierende Implementierung in kürzester Zeit umzusetzen, habe ich einige existierende offene SIP Stacks in Betracht gezogen.

\subsection{SIP Server}
Für den Einsatz als Server bieten sich zwei große Pakete an die beide den SIP Standard nach RFC 3261 unterstützen. 
Asterisk (Version 1.4.19) unterstützt Voice-over-IP (VoIP) mit unterschiedlichen Protokollen  darunter sowohl SIP als auch das H323 Protokoll und bietet alle Möglichkeiten einer Anbindung an das Telefonnetz. 
Die Serveranwendung OpenSer (Version 1.3.1) bietet ähnliche Funktionalität kann als SIP-Proxy, Registrar, aber auch als Location- und Application-Server betrieben werden und bietet zusätzlich das Unterstüztung für das SIP-SIMPLE Protokoll, was den Ausschlag gegeben hat diesen SIP Server zu benutzen. OpenSER ist flexibel einsetzbar, von eingebetteten System wie DSL-Routern bis zu großen Installationen mit mehreren Millionen Benutzern bei Internet Service Providern.
Darüber hinaus existieren noch etliche andere sowohl open source als auch propriätere SIP Server Lösungen, die hier nicht weiter erläutert werden. 

\subsection{Existierende SIP Clients}
%Linux
%http://sourceforge.net/projects/kphone
%www.linphone.org
%Windows
%www.xten.com 
%http://www.minisip.org
%http://gizmo5.com/

Bei den SIP Clients existiert mittlerweile eine Vielzahl an speziellen ausgereiften kostenlosen Softphone Lösungen Lösungen. Einige der bekanntesten open source Softphones für Linux und Windows sind das Ekiga, KPhone oder Linophone, Minisip. Bei diesen Softphones handelt es sich um kostenlose Projekte die frei eingesetzt und modifiziert werden können. Zusätzlich existieren zwar freie Softphones, die von Infrastruktur Betreibern kostenlos werden um den eigenen Marktanteil am VoIP Markt zu erhöhen. Dazu gehören Programme wie X-Lite, Gizmo5 oder OpenWengo, deren Einsatz meist mit der Nutzung der Infrastruktur eines bestimmten Betreibers empfohlen oder vorgesehen wird. 
Zusätzlich zu kompletten Softphones existieren plattformübergriefende SIP Stacks die die Funktionalität von SIP in größeren Anwendungen ermöglichen sollen. Dazu zählen Stacks wie OpenSipStack, sipXtackLib, reSIProcate oder PJSIP.
Eine ausführliche Übersicht über viele der auf dem Markt erhältlichen SIP Clients und Server Anwendungen findet sich unter \cite{sipsoftware08}.

\subsubsection{Pjsip}
Meine persönliche Wahl fiel aus den folgenden Gründen auf PJSIP:
\begin{itemize}
	\item Platformunabhängigkeit
	\item Mögliche Integration mit Irrlicht wegen C und C++ als Programiersprache
	\item Gute Dokumentation 
	\item Unterstützung des SIP und SIP-SIMPLE Standards 
	\item Unterstützung für STUN, TURN und ICE
	\item Unterstützung von Asterisk und Openser
	\item Möglicher Einsatz auf Mobilen Endgeräten
	\item Unterstützung für moderne Audiocodecs wie z.B. Speex oder G.711
	\item Bereits existierender Mediastack mit einer logischen Conference Bridge
	\item Möglichkeit der Anpassung der Lautstärke der einzelnen Audiostreams
\end{itemize}

%Bild PJSIP

Viele der existierenden SIP Stacks kamen für den Prototypen auch deshalb nicht in Frage, weil sie in einer anderen Programiersprache als C oder C++ geschrieben waren und so mit der 3D-Engine nicht integriert werden können. 


\section{Wahl der Netzwerk Architektur}
Wie im Kapitel 3 und 4 vorgestellt existieren mehrere Netzwerkarchitekturen für eine für Spiele als auch für Sprachübertragungen. 

Kapitel 3 enthält vergleichende Studien von Netzwerkarchtiekturen für Spiele und deren Tauglichkeit in ihrem Einsatz als Sprachkommunikationsmedium. Mit der grundsätzlichen Entscheidung SIP zu verwenden ergeben sich aus den in Kapitel 3 vorgestellten Alternativen nur folgende Kombitationen. 

Der Einsatz eines komplett dezentralisierten SIP Netzwerkes auch P2PSIP genannt bei dem sowohl der Datenaustausch als auch der Austausch der Audioströme nur zwischen den einzelnen Peers stattfindet.

Als zentralisierten Ansatz kann man ein SIP Netzwerk mit einer zentralen Komponente bezeichen die für den Austausch auch sämtlicher Daten Spieledaten und der einzelnen Audioströme verantwortlich ist. 

Der Einsatz eines Hybrid Modells würde bedeuten, dass die Datenkommunikation mittels eines Servers Stattfindet, die Sprachkommunikation dagegen zwischen den Clients selbst, was auch dem ursprünglichen SIP Entwurf gleichkommt.

\subsection{P2P SIP}

Bei einem völlig dezentralisierten P2P SIP mittels DHT würden sowohl die Spiele Daten als auch die Sprachlkommunikation nur zwischen den einzelnen Clients ausgetauscht werden. Wie in Kapitel 3 vorgestellt, würde die zentrale Komponente des Registrars durch einen DHT ersetzt werden der die Daten auf den einzelnen Clients verteilt. Dieser Ansatz ist theoretisch möglich führt aber in unserem Fall relativ schnell zu Problemen die den Rahmen der Arbeit sprengen. So ist es zunächst nicht trivial zu bestimmen wer Teilnehmer des Spieles ist und an wen Daten verschickt werden sollen. Es wäre zwar vorstellbar dass jeder Teilnehmer eines solchen P2PSIP Spieles einfach seine Spieldaten an jeden aktiven Teilnehmer sendet wobei jeder Teilnehmer über eine Liste aller Teilnehmer eines Spieles verfügen müsste. 
Wie im Kapitel 3 gezeigt existieren noch viele weitere Ansätze, von denen die meisten bisher auch nur simuliert worden sind und nicht genau genug spezifiziert sind um tatsächlich eine funktionierende Implementierung zu ermöglichen. Zusätzlich dazu existiert noch keine Implementierung eines funktionierenden P2PSIP Overlays was diese Option auf erst in der Zukunft umsetzbar macht. 

\subsection{Zentralisiertes SIP}
Die in Kapitel 4 vorgestellte von Singh und Acharya vorgestellte Methode kann man als zentralisiertes SIP bezeichnen. Obwohl dieser Ansatz es erlaubt verschiedene Konferenzen für verschiedene Orte oder Personen zu kreieren, bleibt das Problem dass eine genaue Steuerung über die empfangegen Audioströme erfordert, dass der Client jedes mal dem Server mitteilen muss wie sein persönlicher Audiostrom gemischt werden muss. Andererseits da der Server auch alle Spieledaten erhält sollte er in der Lage sein die entsprechenden Audioströme für den einzelnen Client so anzupassen, dass dieser seine auf ihn angepasste vorgemischte Audioszene erhält. Diesen Ansatz verfolgen wiederrum Safei und Boustead in den vorgestellten MICE System. 
Prinzipiell ist dieser Ansatz allen anderen Ansätzen überlegen da die eine zentralisierte Komponente in über die Bandbreite verfügt um möglichst viele Audioströme zu empfangen. 

\subsubsection{Kapazität}
Die Grundlagen für die Berechnung versteht sich unter folgenden Vorraussetzungen:
\begin{itemize}
	\item Jeder Person die spricht sendet einen Audiostream zum Server
	\item Jede Person im gleichen Spiel möchte die die gesprochenen Daten der Personen empfangen.
	\item Der Server mischt die Audioströme da er auch die Positionen der Teilnehmer kennt. 
\end{itemize}
Ein Beispiel wäre also wenn sich 12 Personen im Spiel befinden empfängt der Server Audioströme von 12 Persoenen und sendet einen bereits abgemischten Audiostrom an jede der 12 Personen. 

Sendet jeder Spieler seinen Audiostrom mit 16 Kbit/s \cite {speex} an den Server, der nach dem heutigem Standard mit einer 100MBit Anbindung für den Upload und Download ausgestattet ist würde sich folgende Rechnung ergeben:

Upstream/Downstream

\[
 \frac{100000 \frac{Kbit}{s}}{16 \frac{Kbit}{s}} = 6250 Spieler
\]

Der Client selbst muss nur in der Lage sein seinen eigenen Audistrom zu emfpangen und einen Audiostrom mit gleicher Bitrate zu empfangen. 

Probleme dieser Architektur liegen jedoch vor allem im interaktiven Delay und der Fähigkeit des Servers nicht nur Audioströme zu mischen sondern diese gleichzeitig in der jeweiligen Laustärke zu mischen. 

\subsection{SIP Hybrid Model}

\subsubsection{Design alternatives}
\subsubsection[{Replicate registrations vs. search on call setup}
Durch die serverbasierte Architektur kann der server schnell ein Flaschenhals sowohl für die Bandbreite als auch für die Verfügbarkeit werden. Eine Möglichkeit ist der Einsatz mehrerer Redundanter Server. Dabei bestehen zwei Alternativen.

\begin{itemize}
	\item Die Benutzer Lokationsinformations auf allen Servern zu replizieren.
	\item Die Suche nach dem korrekten Server der die Lokation des Benutzers enthält auf allen Servern auszuführen, während die Registrierung nur auf einem Server geschieht.
\end{itemize}

% BILD see \cite{schulzrinne05}

Im ersten Fall könnte durch Datenbanken Replikation Sichergestellt werden dass die Benutzereinträge zwischen verschiedenen Servern konsistent gehalten werden. Im zweiten Fall kann entweder der Benutzer alle Server kontaktieren oder der erste kontaktiere Server die Anfrage weiterleiten. 

Der Nachteil des ersten Ansatzes ist das eine Synchronisation für jede Registrierung erforderlich ist. Es besteht die Möglichkeit dass Einträge veraltet sind bevor eine Synchronisation zwischen den Servern ausgeführt wird. Mit einer wachsenden Anzahl and Benutzern könnte diese Architektur der zusätzliche Netzwerkverkehr zwischen den Servern zu einem Flaschenhals werden. 

Im Anderen Fall ist die Verbindungslatenz höher da erst eine Reihe von Schritten durchlaufen werden muss. Eine parallele Suche erhöht zudem die benötigte Bandbreite.  

Beide Ansätze können fehlschlagen wenn die Anzahl an Benutzern sehr groß wird.

Wie in den oben Angegebenen Studien gezeigt hat bei einem serverbasiertem Modell die Korrelation der Avatare keinen Einfluss auf das interaktive Delay. Das bedeutet dass obwohl sich die Spielerpositionen der Avatare im Spiel zwar konstanten Positionsänderungen unterworfen sind das Delay für jeden Spieler durch das Delay des Servers dominiert wird. Serverbasierte Lösungen zeigen sich auch bei Änderungen der Avatar-Dichte konstant. Da im einfachsten Fall ohne einen Area of Interest Daten unabhängig von den Positionen der Avatare jederzeit an alle Mitspieler übertragen werden hat es keinen Einfluss auf die Netzwerklast ob 10 oder 100 Spieler in der Umgebung befinden. 

Was jedoch großen Einflus auf die Netzwerklast hat ist die Gesammtanzahl der Spieler auf einem solchen zentralisiertem System. Wie bereits erwähnt steigt das Datenvolumen quadratisch mit der Anzahl der Spieler. Da Sprachkommunikation jedoch einen vieflaches größeren Bandbreitenbedarf erfordert als das reine Austauschen von Spielestatus und Positionsinformationen, können auch gut Angebundene Server schon bei kleinen Nutzeranzahlen an ihre theoretischen Grenzen stoßen. 


\subsubsection{Client}

Upstream

\[
 \frac{10000 \frac{Kbit}{s}}{16 \frac{Kbit}{s}} = 62 Mögliche Verbindungen wovon jedoch nur eine einzige gebraucht wird.
\]

Downstream

\[
	\frac{10000 \frac{Kbit}{s}} {16 \frac{Kbit}{s}^{2}} = 39 gleichzeitig Mögliche 
\]

Wichtig bei dieser Berechnung ist dass die Spieleapplikation und andere im Hintergrund laufende Applikationen auch Bandbreite verbrauchen können so dass die oben genannten Werte nur als theoretisches Maximum anzusehen sind. 


Möchte man die gleiche Berechnung für die Clients durchführen so ist sie Rechnung analog vorzunehmen nur dass Up- und Downstream vertauscht sind und eine Anbindung von Clients meist mit 10Mbit/s anzusiedeln ist. 

Die Serverbasierte Lösung wird vor allem von kommerziellen Anbietern favorisiert, die über die entsprechende Infrastruktur verfügen. Die Benutzung einer solchen Software 
\subsection{Peer-to-Peer}


\subsubsection{Netmeeting}
\subsubsection{Ventrillo}
\subsubsection{Teamspeak}
\subsubsection{Battlecom}

\subsection{Reine Peer-to-Peer Modelle}
\subsection{Problems}

Client Server O(1) Lookup Latency vs. Chord O(logN) lookup!
Security Issues 



%TODO Analysis of Ansatz 1
%\cite{schulzrinne07}


