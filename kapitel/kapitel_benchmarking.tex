\chapter{Evaluation}

In diesem Kapitel wird das Resultat der Umsetzung mit konkreten Messergebnissen erfasst. Anhand eines Szenarios wird der Full-Mesh-Ansatz mit dem entwickelten Partial-Mesh-Ansatz verglichen und dabei Einsparungen der Bandbreite aufgezeigt. In einem weiteren Szenario wird der Bandbreitenverbrauch des Prototyps in den in Kapitel 7 vorgestellten Zonen gemessen. Dabei werden jeweils Messungen für die Audiocodec-Variationen, die SIP-Hold-, RTP-Silence-Suppression-Technik vorgenommen. 

\section{Versuchsaufbau}

Um die tatsächliche Bandbreitenveränderungen zu messen, wurden alle versendeten und empfangenen Pakete auf einem Spiel initiierenden Rechner protokolliert\footnote{Gerald Combs: Wireshark 1.0.0, Version 08.05.2008, http://www.wireshark.org/}. Danach wurden die Daten nach den Quell-IP-Adressen gefiltert, um so den Bandbreitenverbrauch den jeweiligen Teilnehmern zuzuordnen. Um den reinen Bandbreitenverbrauch der Audioverbindungen zu messen wurden auch Pakete die die Positionsänderungen der Teilnehmer untereinander broadcasten ausgefiltert. Für alle Messungen wurde die Testumgebung aus Abschnitt \ref{testumgebung} eingesetzt. 

Die virtuellen Zonenradien betrugen 600 Pixel für die private Zone, 1200 Pixel für die soziale Zone und 2400 Pixel für die öffentliche Zone. Die Gesamtgröße des Spielfeldes betrug $5000 \cdot 5000$ Pixel und die Höhe und Breite eines Avatars $300 \cdot 100$ Pixel. 

\subsection{Header-Overhead}
Bei fast\footnote{In Abschnitt \ref{audiocodec-zonen} wurde der Speex-Codec mit einer Abtastrate von 8kHz eingesetzt.} allen Messungen wurde der Speex Codec mit einer Abtastrate von 16kHz benutzt, der eine mittlere Bitrate von 16.8 kbit/s\footnote{Speex Codec Quality Comparison (Xiph OSC) , Version 22.03.2008, http://speex.org/comparison/} besitzt.  Bei beiden lag die Stimm-Abtastrate bei 20ms.

Wie man jedoch in allen Grafiken erkennen kann, weist die tatsächliche verbrauchte Bandbreite jedes Rechners einen Upload von 5kByte/s oder 40 kbit/s auf. Die Differenz zwischen der Nutzlast (Payload) und der tatsächlichen Bandbreite liegt im Header-Overhead. 

Für für die Header werden pro Paket insgesamt 40 Bytes benötigt (IP\footnote{RFC: Internet Protocol, Version 22.03.2008, http://www.ietf.org/rfc/rfc791.txt}: 20 Bytes, UDP\footnote{RFC: User Datagram Protocol, Version 22.03.2008, www.ietf.org/rfc/rfc768.html} : 8 Bytes, RTP\footnote{siehe Abschnitt \ref{rtp-header}} : 12 Bytes). Zusätzlich dazu kommen 20 Bytes VPN-Headerinformationen\footnote{VPN Protocols, Version 22.03.2008, http://www.vpnc.org/vpn-standards.html}, da der Laptop der die Messung ausführte durch einen VPN mit dem Uni-Netz verbunden war. 

Geht man davon aus, dass jedes Paket ein Stimm-Sample überträgt und diese alle 20ms abgetastet werden, ergeben sich 50 Pakete pro Sekunde. Jedes Paket beinhaltet einen VPN/IP/UDP/RTP Header von 480 Bit (60 Byte*8). Also werden pro Sekunde 24.000 Bit (480 Bit * 50) Headerinformationen verschickt. Dies ist genau die Differenz zwischen der Bitrate des Audiocodecs und den tatsächlich verbrauchten Bandbreite.

\section{Full-Mesh vs. Partial-Mesh Szenario}

Um zu verdeutlichen, wie der umgesetzte Ansatz, zu Einsparungen beim Verbrauch der Bandbreite eingesetzt werden kann, wird er mit einem gewöhlichem Full-Mesh Ansatz verglichen, in dem jeder Teilnehmer des Spiels mit allen anderen 
Teilnehmern Audioverbindungen aufbaut, unabhängig davon, wo sich diese im Spiel befinden.

Im vorgeschlagenen Partial-Mesh-Ansatz dagegen, verbindet sich der Teilnehmer nur mit Spielern die sich in seiner unmittelbaren Nähe befinden. Dieses Verhalten entspricht dem umgesetzten Proximitätskonzept, in dem nur Audioverbindungen mit Spielern aufgebaut werden, die sich mindestens in der öffentlichen Zone befinden.

In einem einfachen Szenario werden beide Ansätze ausprobiert: Hier betreten 5 Spieler nacheinander die Spielewelt. Die Nummer des Teilnehmers entspricht der Reihenfolge seiner Teilnahme am Spiel: Zunächst betritt Teilnehmer 1 das Spielfeld, danach Teilnehmer 2 usw... .Spieler 1, 2 und 3 befinden sich in gegenseitiger Hörnähe, während Spieler 5 und 6 isolierte Positionen einnehmen. Da der Versuch mehrmals manuell ausgeführt wurde, sind die Beitritszeitpunkte der Teilnehmer nicht exakt uniform verteilt, was jedoch die Aussagen der Versuchsergebnisse nicht beeinflusst. 

\subsection{Full-Mesh}
Die Szenario-Abbildung \ref{fig:fullmesh} zeigt, dass beim Full-Mesh-Ansatz jeder Teilnehmer Verbindungen zu allen anderen Teilnehmern etabliert und so ein Full-Mesh zwischen allen Teilnehmern gebildet wird. 

\begin{figure}[tbh]
	\centering
		\includegraphics[width=.70\textwidth]{grafiken/fullmesh.eps}
			\caption{Audioverbindungen im Full-Mesh-Ansatz}
	\label{fig:fullmesh}
\end{figure}

Abbildung \ref{fig:fullmesh-withchart} zeigt den Bandbreitenverbrauch von Teilnehmer 1 in Abhängigkeit zur Anzahl der sich im Spiel befindlichen Spielern. Da alle 10 Sekunden ein weiterer Spieler das Spielfeld betritt, wird auch eine Audioverbindung mit diesem Spieler aufgebaut. Diese führt dazu, dass der Verbrauch der Bandbreite sich jeweils um weitere 10kByte/s (5 kByte Up-/ 5 kByte Download) erhöht. Dieses Vorgehen führt bei bereits 5 Anwesenden Teilnehmern zu einem Gesamtbandbreitenverbrauch zwischen Teilnehmer 1 und Teilnehmern 2,3,5 von über 40 kByte/s. Im Full-Mesh fließt zum Zeitpunkt $t4$ zwischen allen Teilnehmern bereits ein Gesamtaudiostrom von 100 kByte/s ($10 \cdot 10kByte/s$).

\begin{figure}[tbh]
	\centering
		\includegraphics[width=\textwidth]{grafiken/fullmeshchart.eps}
	\caption{Bandbreitenverbrauch beim Full-Mesh-Ansatz}
	\label{fig:fullmesh-withchart}
\end{figure}

\subsection{Partial-Mesh}
Im gleichen Szenario wurde nun die Partial-Mesh Technik eingesetzt, bei der nur noch Verbindungen mit Teilnehmern aufgebaut wurden, die sich mindestens in der öffentlichen Zone des Spielers befinden (siehe Abbildung \ref{fig:partialmesh}).

Entsprechend dem Entwurf wird in der öffentlichen Zone zunächst ein SIP Anruf ausgeführt, jedoch gleichzeitig eine \textit{Silence Supression} auf RTP-Ebene vorgenommen. Diese wird so lange aufrecht erhalten, bis der Teilnehmer sich in die Soziale Zone begibt. In der sozialen Zone wird der volle RTP-Audiostrom zwischen den Teilnehmern initiiert. 

Wie man in der Szenario-Abbildung \ref{fig:partialmesh} erkennen kann, führt diese Regel dazu, dass Spieler 1 zunächst zwei logische SIP-Verbindungen mit Spieler 2 und 3 etabliert. Während mit Spieler 2 ein voller RTP-Audiostrom fließt, da sich dieser in der sozialen Zone befindet, wird mit Spieler 3 nur eine Audioverbindung mit \textit{Silence Suppression} etabliert. Teilnehmer 4 und 5 bauen keine Verbindungen auf, da sie sich nicht in Hörreichweite befinden. 

\begin{figure}[tbh]
	\centering
		\includegraphics[width=.70\textwidth]{grafiken/partialmesh.eps}
	\caption{Ein Partial-Mesh der Audioverbindungen der Teilnehmer}
	\label{fig:partialmesh}
\end{figure}

Abbildung \ref{fig:partialmeshchart} zeigt den Bandbreitenverbrauch von Teilnehmer 1 in Abhängigkeit zur Anzahl der sich im Spiel befindlichen Spielern. Zum Zeitpunkt $t1$, in dem Spieler 2 das Spiel betritt, ist der Aufbau einer Audioverbindung, die zwischen 10-15 kByte/s verbraucht, erkennbar. Zum Zeitpunkt $t2$ betritt Spieler 3 das Spiel, diesmal werden nur zusätzliche 1-2 kByte/s zur Aufrechterhaltung der Grundkonnektivität, der RTP-Verbindung unter Silence Supression benötigt. Würde sich Teilnehmer 3 nun auf Spieler 1 zu bewegen, würde die Silence Suppression aufgehoben und auch ein RTP-Audiostrom von 10-15 kByte/s fließen. Spieler 4 und 5 dagegen verursachen keinen zusätzlichen Bandbreitenverbrauch, da sie sich außerhalb der öffentlichen Zone befinden und keine Verbindungen zu ihnen aufgebaut werden. Im Vergleich zu Abbildung \ref{fig:fullmesh-withchart} werden 16 kByte/s verbraucht was auch dem Gesamtverbrauch entspricht. Im Worst-Case, könnten sich alle Teilnehmer im gegenseitigen Hörradius befinden, was dazu führt, dass eine Full-Mesh Topologie zwischen ihnen aufgebaut wird. Hier kann keine Bandbreite eingespart werden und das vorgestellte Verfahren verliert seinen Vorteil.

\begin{figure}[tbh]
	\centering
		\includegraphics[width=\textwidth]{grafiken/partialmeshchart.eps}
	\caption{Bandbreiteneinsparungen beim Partial-Mesh, da nicht mehr alle Verbindungen aufgebaut werden müssen}
	\label{fig:partialmeshchart}
\end{figure}

%\begin{figure}[tbh]
	%\centering
		%\includegraphics[width=0.70\textwidth]{grafiken/fullmesh-worstcase.eps}
	%\caption{Partial-Mesh "`Worstcase"'-Szenario gleicht einem Full-Mesh}
	%\label{fig:fullmesh-worstcase}
%\end{figure}

\section{Zonenkonzepte}
Um den Bandbreitenverbrauch in den einzelnen Zonen aufzuzeigen, wurde ein einfaches Szenario erstellt, bei 2 Spieler am gleichen Ausgangspunkt das Spiel beginnen und sich dann voneinander wegbewegen. Während sie die einzelnen Zonen durchlaufen werden wird der Bandbreitenverbrauch eines Teilnehmers gemessen. Bei der Messung wird nicht nur zwischen dem Up- und Downloadverbrauch, sondern auch zwischen dem des SIP und RTP Protokolls unterschieden. 
Für die drei Implementierungsvariationen (Silence Supression, SIP-Hold, unterschiedliche Audiocodecs), die in Kapitel 7 erläutert wurden und das Ziel haben einer Reduzierung der benötigten Bandbreite zu bewirken, wurde jeweils eine Messung vorgenommen. 

\subsection{Ohne Unterscheidung}
Hier entfernen sich beide Spieler voneinander, es werden jedoch keine Bandbreitenreduzierenden Maßnahmen in Abhängigkeit von der Zone des Spielers getroffen. Man erkennt in der Abbildung \ref{fig:NOVADrtpsip}, dass die Bandbreite sich in allen Zonen gleichmäßig verhält. 

\begin{figure}[tbh]
	\centering
	\caption{Der Up- und Downstream}
		\includegraphics[width=1.00\textwidth]{grafiken/ohnevadupdown.eps}
	\label{fig:NOVADrtpsip}
\end{figure}

Beim Vergleich des RTP und SIP Protokolls in Abbildung \ref{fig:NoVADupdown} sieht man, dass SIP nur zum Signalisieren des Anrufs benutzt wird, da es nur am Anfang und Ende des SIP Anrufs Bandbreite erzeugt, während das RTP Protokoll für den reinen Audiostrom zuständig ist. 

\begin{figure}[tbh]
	\centering
		\includegraphics[width=1.00\textwidth]{grafiken/ohnevadsiprtp.eps}
		\caption{Signalisierung mit SIP, Audiostrom mit RTP}
	\label{fig:NoVADupdown}
\end{figure}

\subsection{Zonen mit RTP Silence Supression}

Hier wird in der öffentlichen Zone eine Silence Supression durchgeführt. In der Abbildung \ref{fig:VADupdown} ist zu erkennen, dass sich hier der Bandbreitenverbrauch auf unter 2kbps reduziert, während er in der privaten und sozialen Zone knapp das 6fache beträgt. 

\begin{figure}[tbh]
	\centering
		\includegraphics[width=1.00\textwidth]{grafiken/mitvadupdown.eps}
		\caption{Der Up- und Downstream mit der VAD-Technik}
	\label{fig:VADupdown}
\end{figure}

In der Abbildung \ref{fig:VADRTPSIP} wurden die SIP und RTP Protokolle dargestellt. Man kann erkennen, dass bei der Silence Supression beim RTP Protokoll die Bandbreite drastisch sinkt. Es wird auch deutlich, dass in diesem Fall nicht das SIP Protokoll eingesetzt wird, um diese Änderung zu bewirken, sondern es sich um eine Eigenschaft des RTP Protokolls handelt.

\begin{figure}[tbh]
	\centering
		\includegraphics[width=1.00\textwidth]{grafiken/mitvadrtpsip.eps}
		\caption{Gegenüberstellung der SIP und RTP Traffics mit der VAD-Technik}
	\label{fig:VADRTPSIP}
\end{figure}

\subsection{Zonen mit SIP HOLD}

Eine weitere Unterscheidung der Zonen wurde mit dem SIP "`Hold Call"' Ansatz versucht, bei dem in der öffentlichen Zone, mittels des SIP Protokolls der logische Anruf gehalten wird, aber auf RTP Ebene keine Übertragung der Pakete stattfindet. Wie Abbildung \ref{fig:mitholdupanddown} zeigt, kann dieser Ansatz sogar noch mehr Bandbreite in der öffentlichen Zone als die Silence Supression einsparen, da praktisch kein Datenaustausch mehr stattfindet.

Allerdings konnte der SIP-HOLD-Ansatz in der Praxis nicht bewähren, da beim Halten und Wiederaufnehmen des Gesprächs, die Sitzungsparameter wieder neu verhandelt werden, was zu einer spürbaren Verzögerung führte. Es ist vorstellbar, dass der SIP Anruf schon etwas früher wiederaufgenommen wird, um diese Verzögerung auszugleichen. 

\begin{figure}[tbh]
	\centering
		\includegraphics[width=1.00\textwidth]{grafiken/mitholdupanddown.eps}
		\caption{Der Up- und Downstream mit der SIP HOLD - Technik}
	\label{fig:mitholdupanddown}
\end{figure}

Beim Bandbreitenvergleich der SIP und RTP Protokolle sieht man, dass eine Signalisierung mittels SIP beim Übergang von der sozialen zur öffentlichen Zone stattfindet. 

\begin{figure}[tbh]
	\centering
	\caption{Gegenüberstellung des SIP und RTP Traffics mit der SIP HOLD-Technik}
		\includegraphics[width=1.00\textwidth]{grafiken/mithold1.eps}
	\label{fig:mithold1}
\end{figure}

\subsection{Zonen mit unterschiedlichen Audiocodecs}
\label{audiocodec-zonen}
Die dritte Variante beinhaltete den Einsatz von 2 verschiedenen Codecs für die Private und Soziale Zone. In der Privaten Zone wurde der qualitativ hohe Speex Codec mit einer Abtastrate von 16kHz verwendet, während in der sozialen Zone nur der Speex Codec mit einer Abtastrate von 8kHz verwendet wurde. 

Da erwartet wird, dass in der sozialen Zone mehr Verbindungen als in der privaten Zone aufgebaut werden, wird hier auch ein Codec mit einer niedrigeren Bitrate verwendet, um eine größere Anzahl an Verbindungen zu ermöglichen. In der öffentlichen Zone wird, wie im oberen Beispiel die \textit{Silence Supression} angewendet. Unter diesen Voraussetzungen ist in Abbildung \ref{fig:mitvadund2codecs} zu sehen, dass der Bandbreitenverbrauch in der sozialen Zone im Vergleich zur privaten Zone reduziert wird und in der öffentlichen Zone sehr gering ausfällt.

\begin{figure}[tbh]
	\centering
		\includegraphics[width=\textwidth]{grafiken/mitvadund2codecs.eps}
		\caption{Speex mit 16kHz in der privaten Zone und Speex 8khZ in der sozialen Zone}
	\label{fig:mitvadund2codecs}
\end{figure}

Im Vergleich (siehe Abbildung \ref{fig:mitvadundrtpsip}) der beiden SIP und RTP Protokolle ist beim SIP Protokoll sowohl der Ruf -auf und -abbau zu erkennen als auch die Signalisierung eines anderen Sprachcodecs beim Übergang von der Privaten in die Soziale Zone. Beim RTP Protokoll ist die Übertragung des Audiostroms und die reduzierte Bitrate in der sozialen und öffentlichen Zone zu erkennen.

\begin{figure}[tbh]
	\centering
		\includegraphics[width=\textwidth]{grafiken/mitvadundrtpsip.eps}
		\caption{Rufauf und -abbau, sowie Signalisierung eines anderen Codecs mit SIP, Reduktion des Audiostroms mit RTP}
	\label{fig:mitvadundrtpsip}
\end{figure}

%\subsection{SIP Benchmarks}
%\subsection{Mixing}
%-- Verbrauch der CPU Last mit Zunehmender Nutzerzahl beim Full Mesh 
%-- Verbrauch der CPU Last mit Zunehmender Nutzerzahl beim Partial Mesh
%--> Müsste zeigen dass weniger Streams gemischt werden müssen und somit Last eingespart werden %kann. ( Wie messe ich das?)
%MESSUNG: einfach nur die conference bridge messen.

\section{Tests von SIP als Netzwerkschnittstelle}

\begin{figure}
	\centering
		\includegraphics[width=1.00\textwidth]{grafiken/rtt-chart.eps}
	\caption{Messung der RTT im LAN zwischen beim Einsatz von 2 Clients}
	\label{fig:rtt-chart}
\end{figure}

- Im Lan gemessen
- zwischen 2 Desktop PCs
- Der Proxy nahm die Messung mit Wireshark vor
- im Lan sind RTT zwischen 0-10ms üblich
--> SIP Layer erzeugt keine übermäßige Latenz


\section{Test der Conference-Bridge}
-- CPU vs Anzahl gleichzeitig abgemischter Audioströme.
