\chapter{Evaluation}

In diesem Kapitel wird das Resultat der Umsetzung mit konkreten Messergebnissen erfasst. Anhand eines Szenarios wird der Full-Mesh-Ansatz mit dem entwickelten Partial-Mesh-Ansatz verglichen und dabei Einsparungen der Bandbreite aufgezeigt. In einem weiteren Szenario wird der Bandbreitenverbrauch des Prototyps in den in Kapitel 7 vorgestellten Zonen gemessen. Dabei werden jeweils Messungen für die Audiocodec-Variationen, die SIP-Hold-, RTP-Silence-Suppression-Technik vorgenommen. Außerdem wird der die Tauglichkeit von SIP als Netzwerkschnitstelle Anhand von Roudtrip-Time-Messungen, sowie die Grenzen der Conference Bridge beim Mischen von Audiosignalen aufgezeigt. 

\section{Versuchsaufbau}

Um Änderungen des Bandbreitenverbrauchs zu messen, wurden alle versendeten und empfangenen Pakete auf einem Spiel initiierenden Rechner protokolliert\footnote{Gerald Combs: Wireshark 1.0.0, Version 08.05.2008, http://www.wireshark.org/} und ausgewertet. Danach wurden die Daten nach den Quell-IP-Adressen gefiltert, um so den Bandbreitenverbrauch den jeweiligen Teilnehmern zuzuordnen. Um den reinen Bandbreitenverbrauch der Audioverbindungen zu messen wurden auch Pakete, die Positionsänderungen der Teilnehmer untereinander broadcasten ausgefiltert. Für alle Messungen wurde die Testumgebung aus Abschnitt \ref{testumgebung} eingesetzt. 

Die virtuellen Zonenradien betrugen 600 Pixel für die private Zone, 1200 Pixel für die soziale Zone und 2400 Pixel für die öffentliche Zone. Die Gesamtgröße des Spielfeldes betrug $5000 \cdot 5000$ Pixel und die Höhe und Breite eines Avatars $300 \cdot 100$ Pixel. 

\subsubsection{Header-Overhead}
Bei fast\footnote{In Abschnitt \ref{audiocodec-zonen} wurde der Speex-Codec mit einer Abtastrate von 8kHz eingesetzt.} allen Messungen wurde der Speex Codec mit einer Abtastrate von 16kHz benutzt, der eine mittlere Bitrate von 16.8 Kbit/s\footnote{Speex Codec Quality Comparison (Xiph OSC) , Version 22.03.2008, http://speex.org/comparison/} besitzt.  Die Stimm-Abtastrate lag bei 20ms.

Obwohl der Audiocodec eine Bitrate von 16.8 Kbit/s besitzt, weist die tatsächliche verbrauchte Bandbreite jedes Rechners einen Upload von 5 KByte/s oder 40 Kbit/s auf, wie man in allen Messungen erkennen kann. Die Differenz zwischen der Nutzlast (Payload) und der tatsächlichen Bandbreite liegt im Header-Overhead. 

Für für die Header werden pro Paket insgesamt 40 Bytes benötigt (IP\footnote{RFC: Internet Protocol, Version 22.03.2008, http://www.ietf.org/rfc/rfc791.txt}: 20 Bytes, UDP\footnote{RFC: User Datagram Protocol, Version 22.03.2008, www.ietf.org/rfc/rfc768.html} : 8 Bytes, RTP\footnote{siehe Abschnitt \ref{rtp-header}} : 12 Bytes). Zusätzlich dazu kommen 20 Bytes VPN-Headerinformationen\footnote{VPN Protocols, Version 22.03.2008, http://www.vpnc.org/vpn-standards.html}, da der Laptop, der die Messung ausführte durch einen VPN mit dem Uni-Netz verbunden war. 

Geht man davon aus, dass jedes Paket ein Stimm-Sample überträgt und diese alle 20ms abgetastet werden, ergeben sich 50 Pakete pro Sekunde. Jedes Paket beinhaltet einen VPN/IP/UDP/RTP Header von 480 Bit (60 Byte*8). Also werden pro Sekunde 24.000 Bit (480 Bit * 50) Headerinformationen verschickt. Dies ist genau die Differenz zwischen der Bitrate des Audiocodecs und den tatsächlich verbrauchten Bandbreite.

\subsubsection{Aktive Silence Supression}

In allen Messergebnissen ist auch zu erkennen, dass die Bandbreite in der sozialen und privaten Zone einer gewissen Varianz von bis zu 3 KByte/s unterliegt. Diese ist auf die aktive Silence Supression in diesen Zonen zurückzuführen, die durchgeführt wird, wenn das Audiosignal einen bestimmten Schwellwert unterschreitet. Diese wird automatisch von PjSIP und dem \textit{Preprocessor} des Speex Audiocodecs durchgeführt. Da die verwendeten  Mikrofone sich hardwarebedingt in ihrer Empfindlichkeit unterscheiden verhalten sich beide Kurven nicht immer exakt gleich.

\section{Full-Mesh- vs. Partial-Mesh-Szenario}

Um zu verdeutlichen, wie der umgesetzte Ansatz, zu Einsparungen beim Verbrauch der Bandbreite eingesetzt werden kann, wird er mit einem gewöhlichem Full-Mesh Ansatz verglichen, in dem jeder Teilnehmer des Spiels mit allen anderen 
Teilnehmern Audioverbindungen aufbaut, unabhängig davon, wo sich diese im Spiel befinden.

Im vorgeschlagenen Partial-Mesh-Ansatz dagegen, verbindet sich der Teilnehmer nur mit Spielern die sich in seiner unmittelbaren Nähe befinden. Dieses Verhalten entspricht dem umgesetzten Proximitätskonzept, in dem nur Audioverbindungen mit Spielern aufgebaut werden, die sich mindestens in der öffentlichen Zone befinden.

In einem einfachen Szenario werden beide Ansätze ausprobiert: Hier betreten 5 Spieler nacheinander die Spielewelt. Die Nummer des Teilnehmers entspricht der Reihenfolge seiner Teilnahme am Spiel: Zunächst betritt Teilnehmer 1 das Spielfeld, danach Teilnehmer 2 usw... .Spieler 1, 2 und 3 befinden sich in gegenseitiger Hörnähe, während Spieler 5 und 6 isolierte Positionen einnehmen. Da der Versuch mehrmals manuell ausgeführt wurde, sind die Beitritszeitpunkte der Teilnehmer nicht exakt uniform verteilt, was jedoch die Aussagen der Versuchsergebnisse nicht beeinflusst. 

\begin {figure}[ht]
\begin{center}
\subfloat[Full-Mesh-Ansatz\label{fig:fullmesh}]{

\includegraphics[width=.5\textwidth]{grafiken/fullmesh.eps}
}
\subfloat[Partial-Mesh-Ansatz\label{fig:partialmesh}]{

\includegraphics[width=.5\textwidth]{grafiken/partialmesh.eps}
}
\caption {Szenario zum Vergleich der Anzahl etablierter Audioverbindungen}
\label{szenario}
\end{center}
\end{figure}

\subsection{Full-Mesh}
Die Szenario-Abbildung \ref{fig:fullmesh} zeigt, dass beim Full-Mesh-Ansatz jeder Teilnehmer Verbindungen zu allen anderen Teilnehmern etabliert und so ein Full-Mesh zwischen allen Teilnehmern gebildet wird. 

%\begin{figure}[tbh]
%	\centering
%		\includegraphics[width=.70\textwidth]{grafiken/fullmesh.eps}
%			\caption{Audioverbindungen im Full-Mesh-Ansatz}
%	\label{fig:fullmesh}
%\end{figure}

Abbildung \ref{fig:fullmesh-withchart} zeigt den Bandbreitenverbrauch von Teilnehmer 1 in Abhängigkeit zur Anzahl der sich im Spiel befindlichen Spielern. Da alle 10 Sekunden ein weiterer Spieler das Spielfeld betritt, wird auch eine Audioverbindung mit diesem Spieler aufgebaut. Diese führt dazu, dass der Verbrauch der Bandbreite sich jeweils um weitere 10kByte/s (5 KByte Up-/ 5 KByte Download) erhöht. Dieses Vorgehen führt bei bereits 5 Anwesenden Teilnehmern zu einem Gesamtbandbreitenverbrauch zwischen Teilnehmer 1 und Teilnehmern 2,3,4 und 5 von über 40 KByte/s. Im Full-Mesh fließt zum Zeitpunkt $t4$ zwischen allen Teilnehmern bereits ein Gesamtaudiostrom von 100 kByte/s ($10 \cdot 10kByte/s$).

\begin{figure}[tbh]
	\centering
		\includegraphics[width=\textwidth]{grafiken/fullmeshchart.eps}
	\caption{Bandbreitenverbrauch beim Full-Mesh-Ansatz}
	\label{fig:fullmesh-withchart}
\end{figure}

\subsection{Partial-Mesh}
Im gleichen Szenario wurde nun die Partial-Mesh Technik eingesetzt, bei der nur noch Verbindungen mit Teilnehmern aufgebaut wurden, die sich mindestens in der öffentlichen Zone des Spielers befinden (siehe Abbildung \ref{fig:partialmesh}).

Entsprechend dem Zonenkonzept wird in der öffentlichen Zone zunächst ein SIP-Anruf ausgeführt, jedoch gleichzeitig eine \textit{Silence Supression} auf RTP-Ebene vorgenommen. Diese wird so lange aufrecht erhalten, bis der Teilnehmer sich in die soziale Zone begibt. In der sozialen Zone wird der volle RTP-Audiostrom zwischen den Teilnehmern initiiert. 

Wie man in der Szenario-Abbildung \ref{fig:partialmesh} erkennen kann, führt diese Regel dazu, dass mit Spieler 2 ein voller RTP-Audiostrom fließt, da sich dieser in der sozialen Zone befindet, während mit Spieler 3 nur eine Audioverbindung mit \textit{Silence Suppression} etabliert wird. Teilnehmer 4 und 5 bauen keine Verbindungen auf, da sie sich nicht in Hörreichweite befinden. 

%\begin{figure}[tbh]
%	\centering
%		\includegraphics[width=.70\textwidth]{grafiken/partialmesh.eps}
%	\caption{Ein Partial-Mesh der Audioverbindungen der Teilnehmer}
%	\label{fig:partialmesh}
%\end{figure}

Abbildung \ref{fig:partialmeshchart} zeigt den Bandbreitenverbrauch von Teilnehmer 1 in Abhängigkeit zur Anzahl der sich im Spiel befindlichen Spielern. Zum Zeitpunkt $t1$, in dem Spieler 2 das Spiel betritt, ist der Aufbau einer Audioverbindung erkennbar, die zwischen 10-15 KByte/s verbraucht. Zum Zeitpunkt $t2$ betritt Spieler 3 das Spiel, diesmal werden nur zusätzliche 1-2 KByte/s zur Aufrechterhaltung der Grundkonnektivität benötigt, da auf RTP-Ebene eine Silence Supression stattfindet. Spieler 4 und 5 dagegen verursachen keinen zusätzlichen Bandbreitenverbrauch, da sie sich außerhalb der öffentlichen Zone befinden und keine Verbindungen zu ihnen aufgebaut werden. Im Vergleich zu Abbildung \ref{fig:fullmesh-withchart} werden hier insgesamt nur 16 KByte/s verbraucht, also eine Einsparung von 60\% vorgenommen. Man darf aber nicht vergessen, dass sich im Worst-Case alle Teilnehmer im gegenseitigen Hörradius befinden können, was dazu führt, dass eine Full-Mesh Topologie zwischen ihnen aufgebaut wird. Hier kann keine Bandbreite eingespart werden und das vorgestellte Verfahren verliert seinen Vorteil.

\begin{figure}[tbh]
	\centering
		\includegraphics[width=\textwidth]{grafiken/partialmeshchart.eps}
	\caption{Bandbreiteneinsparungen beim Partial-Mesh, da nicht mehr alle Verbindungen aufgebaut werden müssen}
	\label{fig:partialmeshchart}
\end{figure}

%\begin{figure}[tbh]
	%\centering
		%\includegraphics[width=0.70\textwidth]{grafiken/fullmesh-worstcase.eps}
	%\caption{Partial-Mesh "`Worstcase"'-Szenario gleicht einem Full-Mesh}
	%\label{fig:fullmesh-worstcase}
%\end{figure}

\section{Zonenkonzepte}
Um den Bandbreitenverbrauch in den einzelnen Zonen aufzuzeigen, wurde ein einfaches Szenario erstellt, bei 2 dem Spieler am gleichen Ausgangspunkt das Spiel beginnen und sich dann voneinander wegbewegen. Während sie die einzelnen Zonen durchlaufen werden wird der Bandbreitenverbrauch eines Teilnehmers gemessen. Bei der Messung wird nicht nur zwischen dem Up- und Downloadverbrauch, sondern auch zwischen dem des SIP- und RTP-Protokolls unterschieden. Für jede der  drei Implementierungsvariationen (RTP-Silence-Supression, SIP-Hold, unterschiedliche Audiocodecs) wurde jeweils eine Messung vorgenommen. 

\subsection{Ohne Einsatz von Zonen}
Hier entfernen sich beide Spieler voneinander, es werden jedoch keine bandbreitenreduzierenden Maßnahmen in Abhängigkeit von der Zone des Spielers getroffen. Man erkennt in der Abbildung \ref{fig:NOVADrtpsip} (siehe Anhang), dass die Bandbreite  in allen Zonen um 10 KByte/s liegt. 

Beim Vergleich der Bandbreite des RTP und SIP Protokolls in Abbildung \ref{fig:NoVADupdown}  zeigt der Plot, dass SIP nur zum Signalisieren des Anrufs benutzt wird, da es nur am Anfang und Ende des SIP Anrufs Bandbreite erzeugt, während das RTP Protokoll für den reinen Audiostrom zuständig ist.  

\subsection{Zonen mit RTP Silence Supression}

Hier wird in der öffentlichen Zone eine Silence-Supression durchgeführt. In der Abbildung \ref{fig:VADupdown}  ist zu erkennen, dass sich hier der Bandbreitenverbrauch auf unter 1kByte/s reduziert, während er in der privaten und sozialen Zone bei fast 10 KByte/s liegt.  

In der Abbildung \ref{fig:VADrtpsip} wurde ein Vergleich der SIP und RTP Protokolle dargestellt. Der Plot zeigt wieder, dass beim Einsatz der Silence Supression beim RTP Protokoll in der öffentlichen Zone die Bandbreite auf unter 1 KByte/s sinkt. Anhand der Unterscheidung der beiden Protokolle wird deutlich, dass es sich um eine Eigenschaft des RTP-Protokolls handelt, da kein SIP-Nachrichtenverkehr beim Übergang zur öffentlichen Zone fließt. 

\subsection{Zonen mit SIP-Hold}

Eine weitere Unterscheidung der Zonen wurde mit dem SIP "`Hold Call"' Ansatz versucht, bei dem in der öffentlichen Zone, mittels des SIP-Protokolls der logische Anruf gehalten wird, aber auf RTP-Ebene keine Übertragung der Pakete stattfindet. Wie Abbildung \ref{fig:mitholdupanddown} zeigt, kann dieser Ansatz sogar noch mehr Bandbreite in der öffentlichen Zone als die Silence Supression einsparen, da praktisch kein Datenaustausch mehr stattfindet.

Allerdings konnte sich der SIP-Hold-Ansatz in der Praxis nicht bewähren, da beim Halten und Wiederaufnehmen des Gesprächs, die Sitzungsparameter wieder neu verhandelt werden, was zu einer spürbaren Verzögerung führte. Es ist vorstellbar, dass der SIP-Anruf schon etwas früher wiederaufgenommen wird, um diese Verzögerung auszugleichen und so beim Erreichen der sozialen Zone einen bereits etablierten Anruf vorzufinden. 

Beim Bandbreitenvergleich der SIP- und RTP-Protokolle sieht man, dass im Gegensatz zur Silence-Supression, eine Signalisierung mit SIP beim Übergang von der sozialen zur öffentlichen Zone stattfindet. 

\subsection{Zonen mit unterschiedlichen Audiocodecs}
\label{audiocodec-zonen}
Die dritte Variante beinhaltete den Einsatz von 2 verschiedenen Codecs für die private und soziale Zone. In der privaten Zone wurde der qualitativ hohe Speex Codec mit einer Abtastrate von 16kHz verwendet, während in der sozialen Zone nur der Speex Codec mit einer Abtastrate von 8kHz verwendet wurde. 

Da erwartet wird, dass in der sozialen Zone mehr Verbindungen als in der privaten Zone aufgebaut werden, wird hier auch ein Codec mit einer niedrigeren Bitrate (11 KBit/s) verwendet, um eine größere Anzahl an Verbindungen zu ermöglichen. In der öffentlichen Zone wird, wie im oberen Beispiel (siehe Abbildung \ref{fig:VADupdown}) die \textit{Silence Supression} angewendet. Unter diesen Voraussetzungen ist in Abbildung \ref{fig:mitvadund2codecs} zu sehen, dass der Bandbreitenverbrauch in der sozialen Zone mit 7 KByte/s im Vergleich zur privaten Zone mit 9 KByte/s um 23\% reduziert wird. In der öffentlichen Zone wird fast 90\% der Bandbreite eingespart. 

Im Vergleich (siehe Abbildung \ref{fig:mitvadundrtpsip}) der beiden SIP- und RTP-Protokolle ist beim SIP-Protokoll sowohl der Rufauf und -abbau zu erkennen, als auch die Signalisierung des anderen Audiocodecs beim Übergang von der Privaten in die Soziale Zone. Beim RTP-Protokoll ist die Übertragung des Audiostroms und die reduzierte Bitrate in der sozialen und öffentlichen Zone zu erkennen. 

Anhand der vorgestellten Beispiele und Messungen sieht man, dass in einer distanzbasierten Sprachkommunikation erfolgreich verschiedene Verfahren eingesetzt wurden, um eine Unterscheidung der Bandbreite in Abhängigkeit von der Entfernung der Teilnehmer vorzunehmen. 
%//TODO Speex VBR and ABR is it possible?

%\subsection{SIP Benchmarks}
%\subsection{Mixing}
%-- Verbrauch der CPU Last mit Zunehmender Nutzerzahl beim Full Mesh 
%-- Verbrauch der CPU Last mit Zunehmender Nutzerzahl beim Partial Mesh
%--> Müsste zeigen dass weniger Streams gemischt werden müssen und somit Last eingespart werden %kann. ( Wie messe ich das?)
%MESSUNG: einfach nur die conference bridge messen.

\section{SIP als Netzwerkschnittstelle}

\begin{figure}
	\centering
		\includegraphics[width=1.00\textwidth]{grafiken/rtt-chart.eps}
	\caption{Messung der RTT im LAN zwischen zwei Clients}
	\label{fig:rtt-chart}
\end{figure}

Für einen Test von SIP als Netzwerkschnitstelle wurden die 2 Desktop-Rechner aus dem Testaufbau (siehe Abschnitt \ref{testumgebung}) eingesetzt, die sich im Spiel befinden und gegenseitig ihre Rotations und Positionsinformationen austauschen. Spielerechner und Proxy befanden sich in einem LAN. Die Messung selbst wurde auf dem Proxy vorgenommen, indem alle versendeten Pakete protokolliert und ausgewertet wurden. 

Um festzustellen, inwiefern die SIP-Abstraktionsebene die Netzwerk-Kommuni\-kation verzögert, wurde die Round-Trip-Time (RTT) gemessen, die angibt wie lange ein Datenpaket in einem Rechnernetz benötigt, um von der Quelle zum Ziel und zurück zu reisen. Dabei wird hier die RTT zwischen dem Versand der MESSAGE-Nachricht und dem Empfang der 200-OK-Nachricht gemessen. dh. sie beinhaltet auch die Verarbeitung und Erstellung der Nachricht beim Quell-/Zielrechner.

Der Plot der RTT-Messung in Abbildung \ref{fig:rtt-chart} zeigt die gemessene RTT beim Versand von Über 6000 Nachrichten. Diese liegt im Durchschnitt bei 1-2 ms und weist auch Verzögerungen bis zu 13ms auf. Da die RTT in einem LAN üblicherweise 1ms beträgt\footnote{Christoph Lüders, Martin Winkler: Pingpong. in: c't. Hannover 2006,23, S.199. ISSN 07248679} liegt die Verzögerung durch den Einsatz von des SIP-Abstraktionslayers bei ca. 1 - 12 ms, was einen akzeptablen Wert darstellt.

\section{Conference-Bridge}
Um zu Messen, wie sich die Conference Bridge beim Mischen verschiedener Audioströme verhält, wurde die CPU-Auslastung eines Mixers auf einem Athlon-Duo 4600+ Rechner mit 3GB RAM, gemessen. Dazu wurde die Conference Bridge verwendet, um künstlich erzeugte Sinus-Audiosignale zu mischen. Obwohl kein Encoding und Decoding verwendet wird, zeigt die Grafik\ref{cpu-chart}, dass bereits beim Einsatz von Resampling bei 32 Teilnehmern die Kapazitätsgrenze des Rechners erreicht wurde. Diese Messung stützt die Annahme aus Kapitel \ref{zentralansatz}, dass Mixing-Server zwar die entsprechende Bandbreite besitzen, um tausende von  Audioströmen entgegenzunehmen, jedoch praktisch aufgrund ihrer CPU-Kapazität nicht in der Lage sind in einer Konferenz so viele Audioströme zu mischen. 

\begin{figure}
	\centering
		\includegraphics[width=1.00\textwidth]{grafiken/confbench.eps}
	\caption{Anstieg der CPU-Last in Abhängigkeit der Anzahl der Abgemischten Audiokanäle}
	\label{fig:confbench}
\end{figure}
\cleardoublepage