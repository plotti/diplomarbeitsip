\cleardoublepage
\chapter{VoIP-Grundlagen}
Dieses Kapitel vermittelt die technischen Grundlagen und erläutert wichtige Komponenten des gewählten SIP-Protokolls, die für eine Umsetzung der in Kapitel 3 entworfenen Sprachkommunikationslösung notwendig sind. Dabei wird eine Übersicht über die zur Sprachübertragung und Signalisierung verwendeten Protokollfamilien SIP, SDP, RTP und RTCP gegeben. 

\subsubsection{Protokolle zur Echtzeitkommunikation}
Voice-over-IP (auch VoIP, IP-Telefonie) bezeichnet die Telefonie über das Internet. Um per VoIP ein Telefongespräch führen zu können, benötigen Benutzer ein software-basiertes SIP-Telefon oder VoIP-Telefon-Hardware. Gespräche sind mit beliebigen Teilnehmern möglich: Sowohl VoiP-Nummern als auch Teilnehmer mit normalen Telefonnummern können angerufen werden.

	Voice-over-IP beinhaltet unterschiedliche Protokolle. Zur reinen Signalisierung werden hauptsächlich das Session Initiation Protocol (SIP) \cite{sip02} bzw. Protokolle aus der H.323-Protokollfamilie\footnote{Da SIP die ältere H.323 Protokollfamilie ablöst, wird diese hier nicht behandelt.} verwendet. Bei VoIP sind generell folgende Klassen der Protokolle zu unterscheiden:
\begin{itemize}
	\item Protokolle für die Sprachübermittlung: Da die Sprachkommunikation in Echtzeit verläuft, sind spezielle Protokolle für die Übermittlung der Sprache über IP-Netze nötig.
	\item Signalisierungsprotokolle: Es handelt sich hier um Protokolle für den Auf- und Abbau von Verbindungen zwischen IP-Telefonen.
\end{itemize}

Für die Signalisierung werden das Session Description Protocol (SDP) \cite{sdp98} und das Session Initiation Protocol (SIP) eingesetzt. Diese übernehmen die Vermittlung von Gesprächen, den Rufauf- oder -abbau, sowie die Aushandlung von Parametern. Die Verwendung eines gemeinsamen Codecs, der entsprechenden Bitrate oder der maximal zulässigen Bandbreite werden in diesen Protokollen kontrolliert. 

Für die Sprachübertragung wird das Echtzeit-Transport-Protokoll (Realtime Transport Protocol (RTP)) \cite{rtp96} ver\-wen\-det, das dem Empfänger der Pakete erlaubt, trotz unzuverlässiger Übertragung über UDP \cite{udp80}, einen Paketverlust festzustellen und die ursprüngliche Reihenfolge der Daten wiederherzustellen. RTP ist nicht nur für Sprache, sondern auch für alle anderen Echtzeitmedien, wie Video verwendbar. Da RTP keine Kontrollinformationen versendet, kann der Empfänger dem Sender nicht mitteilen, ob überhaupt bzw. wie die Sprache in Form von IP-Paketen bei ihm ankommt. Das RTP Control Protocol (RTCP) \cite{rtcp03} gleicht diesen Nachteil aus: Mit Hilfe von RTCP können zusätzlich zu den reinen Mediendaten auch Kontrollinformationen, wie die Anzahl der verlorenen Pakete oder der gemessene Jitter der RTP-Verbindung übertragen werden und so Übertragungsparameter angepasst werden. 

\begin{figure}[tbh]
	\centering
		\includegraphics[width=.60\textwidth]{grafiken/voipprotokolle.eps}
	\caption{Eine Übersicht über die VoIP-Protokollfamilie}
	\label{fig:voipprotokolle}
\end{figure}

%Neben den bisher erwähnten Protokollen zur Hauptfunktionalität gibt es noch noch wei\-te\-re, die sich mit allen angrenzenden Bereichen von VoIP beschäftigen. So wird mit Hilfe des STUN (Simple Traversal of User Datagram Protocol Through Network Address Translators) \cite{stun03} ermöglicht seine IP-Adresse zu ermitteln, falls man sich hinter einem NAT Router befindet und die interne IP-Adresse nicht der externen entspricht. Dies ist vor allem notwendig, da die IP-Kontakt\-in\-for\-mationen in SIP und SDP in der Anwendungsschicht übertragen werden und somit ein Client ohne Kenntnis richtigen Adresse falsche Informationen liefern würde. Ein weiteres Protokoll mit dem Ziel der Überbrückung eines NATs ist TURN(Traversal Using Relay NAT) \cite{turn08}. Bei TURN bekommt ein Client von einem TURN-Server eine öffentlich erreichbares IP-Adressen- und Port-Paar zugewiesen und leitet alle an diese öffentliche Adresse ankommenden Pakete an den Client weiter. 

%Für die Ansteuerung von VoIP-Gateways stehen die Protokolle MGCP(Media Gateway Control Protocol) \cite{mgcp99} und Megaco (Media Gateway Control) \cite{megaco00} zur Verfügung, die im Rahmen der Arbeit jedoch nicht weiter erläutert werden. 

%Dieses Kapitel soll zunächst den Aufbau eines VoIP Systems beschreiben um anschließend die Protokolle SIP, SDP, RTP und RTCP zu behandeln. Da SIP die ältere H.323 Protokollfamilie in langfristig verdrängen wird, wird diese nicht behandelt. %Im Abschluss wird ein Überblick über das propriätere Protokoll von Skype gegeben, dessen Funktionsweise und Details zwar nicht offen sind, es jedoch eine Alternative zu den offenen Protokollen bietet. 
\section{Allgemeines über VoIP}
\subsection{Einfaches VoIP-System}
Der Aufbau eines einfachen VoIP-Systems kann prinzipiell mit einer bestehenden IP-Infrastruktur und Computerprogrammen, die Telefonie ermöglichen (\textit{Softphones}), realisiert werden. Die Teilnehmer müssen jedoch bei einer solchen Konfiguration die IP-Adressen der gewünschten Ge\-sprächs\-partner kennen, um einen direkten Anruf auszuführen. Bei einer Adress\-änderung der IP-Adresse eines Gesprächspartners müssten jedoch alle Einträge der Gesprächspartner entsprechend abgeändert werden, weil sich die Teilnehmer sonst nicht mehr erreichen könnten. Der gleiche Aufwand müsste auch beim Hinzufügen weiterer Teilnehmer erfolgen. %Ein solcher Aufbau wird daher als unflexibel angesehen. 

Im SIP-Protokoll wird dieses Problem von Komponenten (\textit{Proxys}), die die Aufgabe einer Vermittlungsstelle einnehmen, übernommen. Ein Proxy kann einen Lokationsdienst (\textit{Location Service}) enthalten, der ankommende SIP-Pakete an das Telefon des angerufenen Teilnehmers oder an einen anderen Proxy weiterleitet, falls sich der Benutzer außerhalb des eigenen Adressbereichs befindet. Zusätzlich können Konferenzen, Voice-Mail und Anrufweiterleitungen Teil eines VoIP-Systems sein. 

%Da die klassische Telefonie weiterhin neben VoIP Bestand hat, wird versucht mit zusätzlichen Komponenten, den Gateways, eine Verbindung zwischen den beiden Telefonsystemen herzustellen. 


\subsection{Einflussfaktoren auf die VoIP-Qualität}
Die wichtigsten \textit{Quality-of-Service}-Anforderungen, die VoIP an IP-Netze stellt, betreffen:
\begin{itemize}
	\item die Bandbreite von virtuellen Verbindungen zwischen IP-Telefonen,
	\item die Ende-zu-Ende-Verzögerung des Sprachsignals (Delay),
	\item die Schwankung der Übermittlungszeit (Jitter) und
	\item die Paketverlustrate (Packet Loss Rate).
\end{itemize}

\subsubsection{Bandbreite}
Da bei VoIP die Sprache zuerst digitalisiert und dann entsprechend codiert wird, ist die Qualität des übertragenen codierten Sprachsignals abhängig von der Bandbreite für die virtuelle Verbindung zwischen den IP-Telefonen. Dabei können sich die eingesetzten Sprachcodecs in ihren Bitraten stark unterscheiden, wie eine Übersicht in der Tabelle \ref{pt-tabelle} zeigt. Die Bitrate sollte geringer als die vorhandene Bandbreite gewählt werden, da ansonsten nicht alle Pakete übertragen werden können und Störungen auftreten.

\subsubsection{Ende-zu-Ende-Verzögerung (Delay)}
Unter der Ende-zu-Ende-Verzögerung des Sprachsignals versteht man die Zeitspanne, die ein Sprachsignal vom Mund eines Sprechers bis zum Ohr eines Hörers benötigt. Die Ende-Zu-Ende-Verzögerung entsteht vor allem durch die Zwischenspeicherung der IP-Pakete in den Routern, die sie auf ihren Wegen durch das Netz zu durchlaufen haben. Jeder Router benötigt Zeit, um den Header im IP-Paket zu interpretieren und die entsprechende Routing-Entscheidung zu treffen. Trifft ein Paket unterwegs auf einen überlasteten Router, muss es einige Zeit in der Warteschlange vor der Leitung verbringen und wird im Extremfall sogar ganz verworfen. Eine große Ende-zu-Ende-Verzögerung beeinträchtigt den Charakter eines Telefongespräches stark. 

Da die Sprachkommunikation in Echtzeit verläuft gilt die Wiedergabe eines Sprachsignals am Ziel als qualitativ schlecht, wenn sie in einem zu großen Zeitverzug erfolgt. Für die Ende-zu-Ende-Verzögerung $T_{EE}$ (End-to-End-Delay) des Sprach\-signals werden daher Grenzwerte gesetzt. Nach dem ITU-T-Dokument G.114 wird die VoIP-Qualität wie folgt klassifiziert:
\begin{itemize}
	\item $T_{EE}$ kleiner als 150ms: akzeptabel für alle Benutzer,
	\item $T_{EE}$ zwischen 150ms und 300ms: akzeptabel, aber mit Einschränkungen (nicht für empfindliche Benutzer), 
	\item $T_{EE}$ größer als 300ms: nicht akzeptabel. 
\end{itemize}

\subsubsection{Schwankung der Übermittlungszeit (Jitter)}
Da die einzelnen IP-Pakete auf einer Verbindung zwischen IP-Telefonen auf unterschiedlichen Wegen übermittelt werden, kann ihre Übermittlungszeit divergieren. Die Schwankungen der Übermittlungszeit werden Jitter genannt. Die \textit{Synchronität} d.h. die zeitlich konstante Frequenz der übertragenen Signale bei VoIP lässt jedoch kein Jitter zu. Um die Schwankungen auszugleichen, wird beim Empfänger ein spezieller Puffer verwendet. Man bezeichnet einen derartigen Puffer als Jitter-Ausgleichspuffer (\textit{Playout Buffer}).

\subsubsection{Paketverlustrate (Packet Loss Rate)}
Die Verluste von IP-Paketen mit Sprache während der Übermittlung mindern die Qualität. Die Anzahl der Paketverluste in einer bestimmten Zeitperiode wird mit dem Parameter Paketverlustrate angegeben. Paketverluste können durch überlastete Router im IP-Netz oder auch durch einen "`schlecht"'  dimensionierten Jitter-Ausgleichspuffer entstehen. Im Gegensatz zu reinen Datenanwendungen ist der Verlust eines IP-Pakets bei der Sprachübertragung nicht besonders tragisch. Zu viele Paketverluste machen sich in einem Telefongespräch allerdings sehr störend als Unterbrechungen bemerkbar. 

\subsection{VoIP-relevante Sprachkodierungsverfahren}

%TODO enter all Codecs
%\cite{speex08}

Obwohl die Qualität der Sprachübertragung durch Parameter, wie die Laufzeit der IP-Pakete (Delay), die Laufzeitunterschiede (Jitter) und die Verlustrate von IP-Paketen im Netz (Packet Loss) beeinflusst wird, sagen diese Parameter nichts über die eigentliche Sprachqualität aus. Diese wird nach der MOS (Mean Opinion Score) \cite{mtu96} - Skala  gemessen. Sie unterscheidet Aspekte wie Verständlichkeit der Sprache, Akzeptanz der Lautstärke sowie die Akzeptanz der Laufzeitschwankungen und Echos. 

%TODO Tabelle mit Codecs
\begin{table}[tbh]
	\centering
		\begin{tabular}{p{0.2\textwidth}|p{0.6\textwidth}}
		\toprule
		\textbf{MOS-Wert} & \textbf{Bedeutung} \\
		\midrule
		5=excellent & keinerlei Anstrengung zum Verständnis der Sprache notwendig; totale Entspannung möglich \\
		\hline
		4=good & keine Anstrengung notwendig, Aufmerksamkeit nötig \\
		\hline
		3=fair & leichte, moderate Anstrengung nötig \\
		\hline
		2=poor & merkbare, deutliche Anstrengung nötig \\
		\hline
		1=bad & trotz Anstrengung keine Verständigung \\
		\bottomrule
		\end{tabular}
		\caption{Übersicht über MOS-Werte und ihre Bedeutung}
\end{table}

Eine analoge Sprachübertragung kommt auf einen MOS-Wert von 3.5 bis 4. Hochwertige VoIP-Implementierungen bieten eine Sprachqualität zwischen 3.8 und 4.4 je nach verwendeter Sprachkodierung. Dabei bieten VoIP-Systeme mindestens die Qualität eines herkömmlichen analogen Telefonnetzes. 

Es gibt mehrere Sprachkodierungsverfahren, die bei Voice-over-IP verwendet werden können. Man unterscheidet zwischen abtastwert-orientierten Kodierungsverfahren, die zwar gute Sprachqualität garantieren aber Bitraten haben, die größer als 16 Kbit/s sind, und segment-orientierten Kodierungsverfahren, die zwar geringe Bitraten haben, aber dafür nur eine schwache bis gute Sprachqualität bieten. Eine Übersicht üblicher Codecs findet sich in Tabelle \ref{pt-tabelle}.


\begin{table}
\begin{minipage}{\linewidth}
\renewcommand{\footnoterule}{}
\centering
\label{pt-tabelle}
\begin{tabular}{lllr}
\toprule
PT-Nr.\footnote{Die Verwendung von PT-Nummern wird in Absatz \ref{sdp-aufbau} geschildert} & Kodierungsname & Kodierungsart & Bitrate (kbit/s) \\
\midrule
0  & PCM $\mu-Law$ & Abtastwert-orientiert & 64 \\
4  & G723 & Segment-orientiert & 5.3-6.3 \\
8 & PCM A-Law & Abtastwert-orientiert & 64 \\
12  & QCELP & Segment-orientiert & 4.8-6.8\\
15  & G728 & Segment-orientiert & 16\\
18  & G729 & Segment-orientiert & 8\\
dyn & G726-32 & Abtastwert-orientiert & 32 \\
dyn & G726-16 & Abtastwert-orientiert & 16 \\
\bottomrule
\end{tabular}
\end{minipage}
\caption{Überblick über Sprachkodierungsverfahren und Bitraten}
\end{table}

\section{Session-Initiation-Protokoll (SIP)}
Das \textit{Session-Initiation-Protokoll} wurde zuerst im Jahr 1999 als RFC 2543 eingeführt und im Jahr 2002 in den RFCs 3262-3265 weiter spezifiziert. Das SIP-Protokoll ermöglicht es, zwischen kommunizierenden Rechnern über ein IP-Netz eine Sitzung (\textit{Session}) für die Übermittlung von Echtzeitmedien aufzubauen. Die Session stellt einen logischen Kanal dar, über den die Echtzeitmedien mit Hilfe des RTP-Protokolls transportiert werden. SIP definiert bestimmte Nachrichten für den Auf- und Abbau von Sitzungen, ist einfach konzipiert und für Menschen leicht lesbar, da es in Anlehnung an das Internet-Protokoll HTTP entwickelt worden ist. 

\subsection{SIP-Komponenten}
% Über komponenten eines SIP Systems schreiben
In der Architektur sind folgende Systemkomponenten definiert:
\begin{itemize}
	\item User Agent
	\item Proxy Server
	\item Redirect Server
	\item Registrar
\end{itemize}

Obwohl zwischen den Komponenten unterschieden wird, können sie alle in einem Rechner untergebracht werden oder auf verschiedene Computer verteilt werden. Eine typische Konfiguration sieht vor, dass ein SIP-Server die Proxy- und Registrarkomponentene enthält, während der Client nur über den User Agent verfügen.

\textbf{User Agent (UA)}: User Agents sind alle SIP-fähigen Endgeräte. Dazu zählen SIP-Telefone, Softphones oder andere Anwendungen und Hardware, die nach dem SIP-Protokoll kommunizieren. Dabei besteht ein UA intern aus einem User Agent Client (UAC), der Anfragen mittels Nachrichten stellt und einem User Agent Server (UAS), der Anfragen entgegen nimmt. Für die einfachste Form des Verbindungsaufbaus genügen zwei User Agents, wobei jeder der UAS ein UAS oder UAC sein kann. 

\textbf{Proxy Server:} Proxy Server dienen primär dem Routing und der Weiterleitung der SIP-Nachrichten. Zwischen zwei UA können beliebig viele Proxy Server liegen. Proxy Server können Rechtemanagement durchführen und ermitteln, ob ein Benutzer berechtigt ist einen Anruf durchzuführen (Authentification). Es werden zwei Arten von Proxy Servern unterschieden, zum einen der \textit{Stateful Proxy}, der Verbindungszustände zwischen den UA speichert und zum anderen der \textit{Stateless Proxy}, der SIP-Nachrichten lediglich weiterleitet.  Der Verbindungsauf- und abbau läuft bei SIP in der Regel über einen SIP Proxy Server ab, vor allem wenn sich Benutzer in verschiedenen Domänen befinden. Der eigentliche Medienfluss findet jedoch direkt zwischen den User Agents statt. 

\textbf{Redirect Server:} Ein Redirect Server dient selber als UAS und beantwortet Lokationsanfragen eines UAC, indem er diese aus einer angeschlossen Lokationsdatenbank bezieht. Im Unterschied zum Proxy Server leitet er ankommende Anfragen nicht an einen UAC weiter, sondern verweist per Nachricht lediglich auf eine mögliche Lokation des gesuchten UAC. 

\textbf{Registrar:} Der Registrar oder Location Server speichert ausschließlich die  Aufenthaltsorte in Form von SIP-Adressen, nimmt aber an der SIP-Kommunikation zwischen den User Agents nicht teil. User Agents registrieren sich mit ihrem Aufenthaltsort bei einem Proxy Server, der die Information dann an den Registrar übermittelt. Somit kann die Mobilität von Teilnehmern ermöglicht werden. 

\subsection{Aufbau von SIP-Nachrichten}
Die SIP-Nachrichten werden textbasiert aufgebaut. Jede Nachricht setzt sich aus einer Start-Zeile, einem \textit{Message Header} und einem \textit{Message Body} zusammen, wobei der \textit{Message Body} optional ist. Eine SIP-Nachricht stellt entweder eine Anforderung (\textit{Request}) von einem Initiator der Kommunikation oder eine Antwort (\textit{Response}) vom Partner an den Initiator dar. Somit gibt es nur zwei Arten von SIP Nachrichten:

\begin{itemize}
	\item \textit{Request}
	\item \textit{Response}
\end{itemize}

Sowohl \textit{SIP-Responses}, als auch \textit{SIP-Requests} sind ähnlich aufgebaut und haben die folgende Struktur:

% Bild vom SIP Message
\begin{figure}[h]
\lstset{frame=single}
	\begin{lstlisting}[label={SIP-Message}]
INVITE sip:8495302002@192.168.2.25 SIP/2.0
Via: SIP/2.0/UDP 192.168.3.250:5060; branch=1
From: sip:8495305005@192.168.2.25;tag=29ae1249
Max-Forwards: 70
To: sip:8495302002@192.168.2.25
Call-ID: 48c7df2a9b4@myvoip1
Cseq: 1 INVITE
Contact: sip:8495305005@192.168.3.250
Content-Length: 202
Supported: 100rel
Content-Type: application/sdp
\end{lstlisting}
\caption{Beispiel eines typischen SIP-Requests}
\end{figure}

Die Start-Zeile (\textit{Status-Line}) besteht bei den Requests aus einer Angabe des Request-Typs z. B. INVITE, einer \textit{Request-URI}(z. B. sip:8302002@192.168.2.25) als Ziel-Adresse und der SIP-Version. Bei einem Response enthält die \textit{Status-Line} die SIP-Version und einen \textit{Status-Code}, der den Nachrichtentyp definiert. Beide Typen von Nachrichten enthalten mehrere Header-Felder, von denen folgende besonders hervorzuheben sind:
\begin{itemize}
	\item From: Dieses Feld enthält einen Namen und eine SIP-URI, die den Absender eindeutig identifiziert. 
	\item To: Der To-Header identifiziert den logischen Empfänger der Anfrage und entspricht der URL in der Anfragezeile. Diese Headerzeile ist ähnlich der des From-Headers aufgebaut.
	\item Contact: Contact gibt eine SIP-URI an, unter der die Gegenstelle für weitere
Anfragen erreicht werden kann. Das Format entspricht dem der To- und From-Header. Ein Parameter für diese Headerzeile ist \textit{expires}, der die Zeit in Sekunden angibt, bis der Kontakt nicht mehr verfügbar ist.
	\item Call-ID: Diese identifiziert den Anruf. Jeder Anruf enthält eine ID, die sich aus einer Zufallszahl und den Namen des Anrufenden zusammensetzt. 
\end{itemize}

\subsubsection{Request-Typen}
In der Spezifikation RFC 3261 werden sechs Request-Typen definiert, die jedoch inzwischen um weitere Request Typen erweitert wurden:
\small
\begin{itemize}
	\item \textbf{INVITE}: Mit INVITE initiiert ein IP-Telefon einen neuen Anruf. Eine INVITE Nachricht enthält die SIP-Adresse von beiden Teilnehmern, einen Grund (Subject) und dessen Priorität.
	\item \textbf{BYE}: Mit BYE wird der Abbau der bestehenden VoIP-Verbindung zwischen zwei Teilnehmern initiiert.
	\item \textbf{ACK}: ACK dient als "`positive"' Bestätigung mit der die Annahme eines ankommenden Anrufes bestätigt wird.
	\item \textbf{OPTIONS}: Mit dieser Nachricht kann man die Fähigkeiten eines Teilnehmers befragen (\textit{Media Capabilities}), die bestimmen welche Arten von Medien empfangen werden können und welche Verfahren zur Kodierung dieser Medien unterstützt werden.
	\item \textbf{CANCEL}: Mit CANCEL kann eine bereits initiierte VoIP-Verbindung abgebrochen und vorzeitig beendet werden. 
	\item \textbf{REGISTER}: Mit REGISTER werden dem \textit{Registrar} Informationen über die Lokation des Teilnehmers mitgeteilt. 
\end{itemize}

Ausgewählte erweiterte Request-Typen, die in zusätzlichen RFCs (3428,3265) nach\-träg\-lich definiert worden sind:

\begin{itemize}
	\item \textbf{MESSAGE}: Mit MESSAGE Nachrichten kann Inhalt in der Form von \textit{Multi\-media Internet Message Extensions} (MIME) Nachrichten über\-tragen werden.  MESSAGE-Nachrichten initiieren keinen SIP-Dialog und werden üblicherweise wie normale Kurz\-nachrichten verstanden. 
	\item \textbf{SUBSCRIBE, PUBLISH und NOTIFY}: SIP kann verwendet werden, um bestimmte Ereignisse zu übermitteln. Hierfür sind die Nachrichten SUBSCRIBE, PUBLISH  und NOTIFY eingeführt worden. So kann z. B. die Anwesenheit eines Teilnehmers von weiteren Teilnehmern mit einer SUBSCRIBE-Nachricht abonniert werden. Geht dieser Teilnehmer online, so benachrichtigt er alle anderen Teilnehmer mit einer PUBLISH-Nachricht an den Presence-Server. Dieser sendet NOTIFY-Nachrichten an alle Abonnenten des Anwenders.  
\end{itemize}

\subsubsection{Response-Typen}
\small
Im RFC 3261 werden ebenfalls sechs Response-Klassen spezifiziert, die dem Absender des Requests eine Response signalisieren. Diese Klassen sind in die Nummernräume von 100 bis 600 unterteilt.

\begin{itemize}
	\item \textbf{100er Klasse (Information)}: Nachrichten dieser Klasse teilen mit, dass der Request weiter bearbeitet wird.
	\begin{itemize}
	\item 100: Trying - der Empfänger ist dabei, die empfangene Nachricht zu verarbeiten. Eine endgültige Antwort steht noch aus.
	\item 180: Ringing - dem Anrufenden wird mitgeteilt, dass der eingehende Anruf über einen Klingelton signalisiert wird.
	\end{itemize}
	\item \textbf{200er Klasse (Erfolg)}: Eine Nachricht dieser Klasse teilt mit, dass der Request erfolgreich empfangen und akzeptiert wurde. Der Response besteht nur aus der 200-OK-Nachricht.
	\item \textbf{300er Klasse (Weiterleitung}): Hier wird mit dem Absender eines Requests signalisiert, dass weitere Aktionen bei der Bearbeitung des Requests nötig sind. Beispielhafte Weiterleitungen:
	\begin{itemize}
	\item 301 Moved Permanently 
	\item 302 Moved Temporarily 
	\end{itemize}
	\item \textbf{400er Klasse (Fehler)}: Fehlernachrichten teilen mit, dass der Request eine falsche Syntax hat oder nicht ausgeführt werden kann. 
	\begin{itemize}
	\item 400 Bad Request
	\item 401 Unauthorized  
	\item 403 Forbidden - Der Anruf ist nicht zulässig.
	\item 404 Not Found - Der Benutzer kann nicht gefunden werden.
	\item 486 Busy Here - Indiziert, dass der Angerufene sich gerade in einem Gespräch befindet und den Anruf nicht annehmen kann.
	\end{itemize}
	\item \textbf{500er Klasse (Server Fehler)}: Diese Nachrichten teilen mit, dass der Server nicht in der Lage war den Request auszuführen. Einige Beispiele sind:
	\begin{itemize}
	\item 500 Internal Server Error
	\item 505 SIP Version not supported
	\end{itemize}
	\item \textbf{600er Klasse (Globale Fehler)}: Es wird mitgeteilt, dass der Request auf keinem der Server des Netzes ausgeführt werden konnte. 
\end{itemize}
\normalsize

\subsection{Betriebsarten bei SIP}
\subsubsection{Rufaufbau, Verbindung, Rufabbau}
\label{rufaufbau}
% Grafik über Rufaufbau

Teilnehmer A möchte zu Teilnehmer B eine Verbindung herstellen. Dazu sendet er eine SIP-Nachricht INVITE an Teilnehmer B. Die Nachricht enthält die Beschreibung der RTP-Session nach dem SDP-Protokoll und alle notwendigen Angaben, wie z. B. die Sprachkodierung, damit Teilnehmer B prüfen kann, ob eine Session hergestellt werden kann. Falls Teilnehmer B die Verbindung annehmen kann, klingelt das angerufene IP-Telefon von Teilnehmer B, dies wird mit der SIP-Response 180 Ringing signalisiert. 
Hat nun Teilnehmer B den Hörer abgehoben, sendet er einen SIP-Response 200 OK, der vom Teilnehmer A mit der Nachricht ACK bestätigt wird. Mit dem Empfang der ACK-Nachricht von Teilnehmer B, ist die logische Verbindung aufgebaut\footnote{Ist ein Teilnehmer nicht erreichbar, wird der Rufaufbau nach Ablauf einer bestimmten Zeit abgebrochen} der Rufaufbau statt oder ist ein Fehler aufgetreten . Nun kann eine Verbindung nach dem Protokoll RTP verlaufen und es besteht eine Session zwischen den Teilnehmern. 
Die bestehende RTP-Session kann von beiden Seiten beendet werden. Beendet Teilnehmer A durch das Absenden der SIP-Nachricht BYE die Session, bestätigt Teilnehmer B den Empfang der Nachricht mit der SIP-Response 200 OK. Mit dem Empfang von 200 OK beim IP-Telefon des Teilnehmers A wird die Session beendet. 
\begin{figure}[h]
	\centering
		\includegraphics[width=.60\textwidth]{grafiken/sipanruf.eps}
	\caption{SIP-Anruf ohne Proxy}
	\label{fig:sipanruf}
\end{figure}

\subsubsection{Registrierung der Lokation von Teilnehmern}
\label{sip-register}

\begin{figure}[h]
	\centering	\includegraphics[width=1.00\textwidth]{grafiken/sipanrufmitproxy.eps}
	\caption{Einsatz eines Proxy Servers mit Registrar}
	\label{fig:sipanrufmitproxy}
\end{figure}

SIP definiert eine spezielle Komponente, die als Registrar bezeichnet wird. Ein Registrar enthält die Angaben hinsichtlich der Lokation von Teilnehmern in einer Domain. 

Dadurch, dass ein Teilnehmer mobil sein und verschiedene Clients benutzen kann, können ihm auch verschiedene Lokationen zugeordnet werden, und so kann er seine aktuelle Lokation beim Registrar anmelden. Hierfür wird die Request-Nachricht REGISTER verwendet. Mit dieser Nachricht kann jeder Teilnehmer die Umleitung der bei ihm ankommenden Anrufe selbst veranlassen. 

Möchte z. B. ein Teilnehmer mit der SIP-Adresse \textit{sip:bob@uni-mannheim.de} in seiner Heimat-Domain \textit{uni-mannheim.de} Anrufe entgegennehmen, so wird an den Registrar, z. B. \textit{registrar.uni-mannheim.de} dieser Wunsch mit der Request Nachricht REGISTER mitgeteilt. Relevante Felder der Nachricht enthalten die Herkunft (From), die Lokation des Benutzers (Contact) und die Gültigkeit der Nachricht (Expires). Wechselt der Benutzer vor Ablauf der Expire-Zeit seine Lokation, so wird der Registrar mit einer weiteren Nachricht darüber aktualisiert. Der Registrar bestätigt den Empfang der Nachrichten jeweils mit einer ACK-Nachricht. Ebenso ist eine Registrierung über eine andere Person möglich, so kann z. B. die Sekretärin die aktuelle Lokation ihres Chefs aktualisieren. 

\subsection{Spezielle Dienstmerkmale}
\subsubsection{Instant Messaging zwischen Teilnehmern}

Als Instant Messaging wird im Allgemeinen ein Dienst zur sofortigen Über\-mittlung von Nachrichten zwischen Teilnehmern eines Netzwerks verstanden. Es existieren viele proprietäre Protokolle wie IRC (Internet Relay Chat), XMPP (Extensible Messaging and Presence Protocol) und OSCAR (Open System for CommunicAtion in Realtime). Auch bei SIP wurde in den RFCs 3860, 3428 und 3265 ein Protokoll für das Instant Messaging definiert: SIMPLE (SIP for Instant Messaging and Presence). 

Eine SIP-MESSAGE-Transaktion kann sowohl über einen PROXY laufen als auch direkt zwischen den UACs stattfinden. Möchte Teilnehmer A eine Nachricht an Teilnehmer B verschicken, so wird diese mittels der MESSAGE Nachricht versendet und vom Empfänger mit einer ACK-Nachricht bestätigt. Die wichtigsten Felder der MESSAGE-Nachricht sind das Empfänger-Feld (To), der Typ des Inhalts (Content-Type), dessen Länge (Content-Length) und der Inhalt selbst (Body). 

\begin{figure}[h]
	\centering
		\includegraphics[width=1.00\textwidth]{grafiken/sipmessage.eps}
	\caption{Teilnehmer A schickt Teilnehmer B eine Nachricht. Beide sind Teil der gleichen Domäne und benutzen den gleichen Proxy.}
	\label{fig:sipmessage}
\end{figure}

Der grundlegende Unterschied zum SIP-Protokoll beruht darauf, dass hier kein separater Medienstrom existiert. Die Textnachrichten werden in einem SIP-Paket über die Knoten übertragen, die den Signalisierungspfad bilden. Dies erfordert ein größeres Bedürfnis nach Sicherheit als bei anderen SIP-Anfragen, da der Benutzer allen Proxys vertrauen muss. Unverschlüsselte Nachrichten können hier mitgelesen werden und auch eventuelles Abzweigen von Nachrichten (\textit{Forking}) ohne Wissen des Benutzers ist hier möglich. 

%RFC 3428
\subsubsection{Präsenzfunktion von Teilnehmern}

% Grafik über Publish Subscribe

Die SIP-Präsenzfunktion dient zur Anzeige des Präsenzstatus' anderer Teilnehmer. Die Verwendung eines Präsenzstatus ist in vielen Instant-Messaging-Anwendungen weit verbreitet und in verschiedenen Protokollen wie IMPS (Instant Messaging and Presence Service) oder XMPP (eXtensible Messaging and Presence Protocol) etabliert. SIP besitzt eine eigene Erweiterung für Ereignisse, die in den RFCs 3265 und 3903 definiert wurde. Diese beinhaltet die Nachrichtentypen PUBLISH, SUBSCRIBE und NOTIFY. 

Will ein Teilnehmer ein Ereignis wie z. B. seine Statusänderung veröffentlichen, so schickt er eine PUBLISH-Nachricht an den Presence-Server, der üblicherweise Teil eines Proxys ist. Dabei enthält die Nachricht den Event Typ im Header, die relevanten PUBLISH-Informationen im XML-Format (Extensible Markup Language) im Body-Feld. Grundsätzlich sind beliebige Formate nutzbar, wobei ein Standard speziell für die Präsenz\-information PIDF (Presence Information Data Format) existiert. Ein solches PIDF-Tupel kann beispielsweise den Namen des Teilnehmers, seinen Status und eine NTP-Zeit enthalten. 

 Um z. B. die Präsenz bestimmter Teilnehmer zu abonnieren, versendet der Benutzer eine SUBSCRIBE-Nachricht an den Presence-Server. Die Länge des Dialogs wird durch das Laufzeit-Feld deklariert (Expires). Soll ein Abonne\-ment vorzeitig gekündigt werden, so kann eine SUBSCRIBE-Nachricht mit der Laufzeit 0s verschickt werden. Der Erhalt einer solchen Nachricht führt dazu, dass ein Dialog zwischen Presence-Server und dem Teilnehmer eingeleitet wird. Eine NOTIFY-Transaktion informiert nun den Abonnenten über seine abonnierten Ereignisse, wie z.B. den Präsenzstatus eines Teilnehmers. 

\begin{figure}[h]
	\centering
		\includegraphics[width=1.00\textwidth]{grafiken/sippresence.eps}
	\caption{Teilnehmer A möchte die Präsenz von Teilnehmer B abonnieren. Teilnehmer B aktualisiert seine Information.}
	\label{fig:sippresence}
\end{figure}

\section{Session-Description-Protokoll (SDP)}
Das Session-Description-Protokoll (SDP) wird vom Signalisierungsprotokoll SIP dazu benutzt, die Eigenschaften des Medienstroms sowie den verwendeten Codec, Transportprotokoll und Zieladresse mit Port festzulegen. 

\subsubsection{Aufbau von SDP-Nachrichten}
\label{sdp-aufbau}

SDP ist ein textbasiertes Format, in dem die Eigenschaft und der Wert in Textform in der Nachricht festgehalten werden. Die Nachricht enthält die Besonder\-heiten der RTP-Session, die durch das SDP-Protokoll festgelegt wird. Die Nachricht setzt sich aus der Spezifikation der RTP-Session, der Zeitbeschreibung und der Medienbeschreibung zusammen. 

% Bild der SDP message
% Bild vom SIP Message
\begin{figure}[h]
\lstset{frame=single}
	\begin{lstlisting}[label={SDP-Message}]
v=0
o=Anonymous 1234567890 1234567890 IN IP4 192.168.3.250
s=Testing the SDP Message
t=0 0
m=audio 6006 RTP/AVP 8 3 0
a=rtpmap:8 PCMA/8000
a=rtpmap:3 GSM/8000
a=rtpmap:0 PCMU/8000
\end{lstlisting}
\caption{Beispiel einer SDP-Nachricht}
\end{figure}


Die Beschreibung der RTP-Session wird mit den folgenden Parametern definiert:
\begin{itemize}
	\item v: Gibt die verwendete RTP Version an.
	\item o: Enthält den Initiator der Nachricht an:
	\subitem $\left\langle username \right\rangle$: den Namen des Initiators der Session
	\subitem $\left\langle session id \right\rangle$: die Identifikation der Session, meistens der NTP-Stempel.
	\subitem $\left\langle network type \right\rangle$: der Netztyp
	\subitem $\left\langle address type \right\rangle$: der Typ der Quell-IP-Adresse
	\subitem $\left\langle address \right\rangle$: die Quell-IP-Adresse
	\item s: Gibt eine genauere Bezeichnung der Session an, z. B. den Namen
	\item t: Bestimmt die Start- und Endzeit der Session. 
	\item m: In der Media-Zeile werden folgende Parameter angegeben:
	\subitem $\left\langle media \right\rangle$: Hier wird die Medienart (z. B. Audio) definiert.
	\subitem $\left\langle port \right\rangle$: Die Nummer des Ports, über den das Medium empfangen wird.
	\subitem $\left\langle transport \right\rangle$: Das verwendete Transportprotokoll
	\subitem $\left\langle fmt list \right\rangle$: Eine Liste der zulässigen Formate des Mediums
	\item a: Hier wird eine Liste angegeben, welches Format des Mediums empfangen werden kann. 
\end{itemize}

Den "`klassischen"' Audio Formaten sind feste Nummern\footnote{Eine Übersicht üblicher PT-Nummern ist in der Tabelle \ref{pt-tabelle} dargestellt} zugeordnet. Weitere Typen befinden sich im dynamischen Bereich und können für jede Sitzung zu beliebigen Medienformaten vereinbart werden.

\subsubsection{Aushandeln der Sitzungsparameter}
Die unter dem Parameter \textbf{"`a"'} ausgetauschte Liste der Medienformate entspricht in der Reihenfolge den Präferenzen des Senders. Der Empfänger eines solchen Angebots beantwortet jedes empfangene Medienformat mit einer korrespondierenden Antwort, falls er dieses Medienformat unterstützt. Ein Medienstrom kann vom Empfänger abgelehnt werden, wenn keines der aufgelisteten Medienformate unterstützt wird, indem als Port eine Null gesendet wird. Nach Möglichkeit sollte die Reihenfolge der unterstützten Medienformate aus dem Angebot beibehalten werden, nicht unterstützte Formate sollten dagegen ausgeblendet werden.

Nachdem sich beide Teilnehmer auf die unterstützten Formate geeinigt haben, können beide Seiten damit beginnen, die Mediendaten im jeweils bevorzugten Format zu senden. Während einer Sitzung können die Parameter neu verhandelt werden, indem der gleiche Ablauf mit entsprechend modifizierten SDP-Beschreibungen durchgeführt wird. 

\section{Real-time-Transport-Protokoll (RTP)}
Speziell für die Übermittlung von Sprache, Audio und Video über IP-Netze wurde RTP (Real-time-Transport-Protokoll) bei der IETF entwickelt (RFC 2550). Einerseits stellt RTP ein Transportprotokoll für die Echtzeitmedien dar, ander\-seits kann es als eine Anwendungsart oberhalb des verbindungslosen Protokolls UDP angesehen werden. 

Die wichtigsten Eigenschaften von RTP sind:

\begin{itemize}
	\item Übermittlung von Echtzeitmedien in RTP-Paketen: Echtzeitmedien werden in RTP als eine zusammenhängende Folge von RTP-Paketen über eine RTP-Session übermittelt. 
	\item Garantie der Reihenfolge von RTP-Paketen: RTP nummeriert die über\-tra\-genen Pakete mit Echtzeit\-medien, sodass ihre richtige Reihenfolge am Ziel wiederhergestellt werden kann, falls sie durch den Transport über das IP-Netz verändert wurde. 
	\item Garantie der Synchronität: RTP vergibt den übertragenen Paketen einen Zeitstempel, so dass die gleichen Zeitabstände am Ziel wiederhergestellt werden können, die beim Absender bestanden. 
	\item Transport unterschiedlicher Formate: Es können unterschiedliche Formate wie Audio, Sprache und Video übertragen werden, die in unterschiedlichen Profilen genau bezeichnet werden. 
\end{itemize}

\subsubsection{Aufbau von RTP-Paketen}
\label{rtp-header}
RTP übermittelt ein Echtzeitmedium als Folge von RTP-Paketen, die mit einem vorangestellten UDP-Header in den IP-Paketen transportiert werden. Jedes RTP-Paket enthält einen RTP-Header und die Nutzlast (\textit{Payload}). Die wesentlichen Angaben im RTP-Header sind:

\begin{figure}[h]
	\centering
		\includegraphics[width=1.00\textwidth]{grafiken/rtppaket.eps}
	\caption{Header eines RTP-Pakets}
	\label{fig:rtppaket}
\end{figure}

\begin{itemize}
	\item PT (\textit{Payload Type}): Es wird angegeben, um welches Format es sich beim transportierten Medium handelt, d. h. nach welchem Verfahren codiert wurde. Die möglichen Kodierungsarten sind in RFC 3551 festgelegt. 
	\item Timestamp: Der Zeitstempel dient dazu, den Zeitpunkt der Generierung vom \textit{Payload} zu markieren. Der Zeitstempel ist nötig, um die Schwankungen der Übertragungszeit (Jitter) von RTP-Paketen beim Empfänger auszugleichen. 
	\item Sequence Number: Jedes RTP-Paket wird mit einer Sequenznummer versehen, die es dem Empfänger erlaubt, den Verlust von Paketen festzustellen, bzw. die Reihenfolge wiederherzustellen, falls sie in einer falschen Reihenfolge angekommen sind. 
	\item SSRC (\textit{Synchronization Source Identifier}): Zur Identifikation der Quelle (Mikrofon, Kamera) dient der SSRC. Zwei verschiedene Quellen müssen unterschiedliche SSRCs haben, um für den Empfänger unterscheidbar zu sein. 
	\item CSRC (\textit{Contributing Source Identifier}): Wird optional verwendet und enthält die "`Orginal"'-Quellen der Bitströme falls der SSRC von einem Mixer verändert wurde.
\end{itemize}

Die PT-Nummern dienen zur Identifikation der einzelnen Audio- und Video-Formate. Da der Nummernraum nicht komplett belegt ist, können weitere Nummern vergeben werden (dynamische PT-Nummern). Bei der Verwendung von dynamischen PT-Nummern wird die Kompatibilität zwischen Empfänger und Sender mit Hilfe des SDP Protokolls vereinbart (siehe Tabelle \ref{pt-tabelle}).

\subsection{RTP Control Protokoll}
RTP wird mit RTCP so ergänzt, dass Informationen über den Verlauf der Kommunikation zwischen Sender und Empfänger, insbesondere über die Qualität der Übertragung, ausgetauscht werden können. 

Die wichtigsten Aufgaben von RTCP sind die Überwachung der Über\-tragungs\-qualität: Hierfür werden zwischen Sender und Empfänger laufend Informationen über die Qualität der Übertragung mittels Sender- und Receiverreports ausgetauscht. Dies ermöglicht es dem Sender, den von ihm generierten Bitstrom an die Netzbedingungen anzupassen und so Fehler einzugrenzen. 

\subsubsection{Typen und Struktur der RTCP-Pakete}
Beim RTCP werden folgende RTCP-Pakete als Nachrichten verwendet. 
\begin{itemize}
	\item Sender Report (SR)
	\item Receiver Report (RR)
	\item Source Description (SDES)
	\item Abmeldung (BYE)
	\item Applikationsspezifisches Paket (APP)
\end{itemize}

RTCP Pakete beginnen mit einem Header und können unabhängig von anderen bearbeitet werden. Die Reihenfolge der Pakete in einem IP-Paket kann beliebig sein. 
Das SR-Paket enthält einen Zeitstempel gemäß des NTPs (Network-Time-Protocol) und beschreibt die Qualität der Übermittlung aus Sicht des Senders. So kann z. B. dem Empfänger die Sendedatenrate mitgeteilt werden, damit dieser sich im Voraus auf die ankommende Datenmenge einstellen kann. 

In einem Sender-Report sind immer enthalten:
\begin{itemize}
	\item NTP-Zeitstempel: Ein Zeitstempel gemäß der NTP-Uhrzeit. 
	\item RTP-Zeitstempel: Die NTP-Zeit in Zeiteinheiten der RTP-Session, die pri\-mär dazu dient verschiedene Quellen zu synchronisieren.
	\item Gesendete Pakete: Die Anzahl der gesendeten Pakete sowie Bytes.
\end{itemize}

Beim RR-Paket werden Werte wie Jitter, Round-Trip-Delay (Verzögerung für Hin- und Rückübertragung)  oder Paketverlust aus Sicht des Empfängers berechnet und abgeschätzt. 

In einem Receiver-Report sind unter anderem folgende Informationen enthalten:
\begin{enumerate}
	\item Paketverlust: Der Anteil der verlorenen Pakete seit dem letzten Report und auch die Gesamtanzahl der verlorenen Pakete.
	\item Jitter: Der Jitter wird geschätzt als die Varianz der Ankunftszeitdifferenzen der Pakete.
	\item Letzter Report: Die verstrichene Zeit seit dem Empfang des letzten Reports.
\end{enumerate}

Die SDES-Pakete ermöglichen es, die Quellen mit Namen zu kennzeichnen. Diese Kennzeichnung wird vom Empfänger dazu verwendet, mehrere Bitströme einer Quelle, die in getrennten RTP-Sessions übertragen werden, wieder zusammenzuführen. Das BYE-Paket dient dazu, das Ende der Teilnahme an einer Kommunikation anzuzeigen. 

\subsubsection{Silence Supression}
Teilnehmer einer Audio-Verbindung müssen nicht unbedingt Audiopakete über den RTP-Strom senden, falls gerade bei den Teilnehmern Stille herrscht. Diese Funktion wurde im RFC 3389 spezifiziert.

Die Möglichkeit, den RTP Paketversand während Stilleperioden zu unterbrechen wird als "`Stille Unterdrückung"' (\textit{Silence Suppression}) oder "`Stimm-Aktivitäts-Erkennung"' (\textit{Voice Activity Detection}) bezeichnet. Silcence Suppression kann vom Empfänger erkannt werden, wenn der RTP-Zeitstempel nicht mit dem Intervall übereinstimmt, das vom letzten Paket abgedeckt wurde, obwohl die RTP-Sequenznummer sich nur um 1 erhöht hat. Ob Silence Suppression eingesetzt wird, hängt normalerweise von der Konfiguration der beiden Endpunkte ab.

\section{NAT Traversal} 
Unter NAT Traversal versteht man das Erkennen und Durchdringen von Firewalls und NAT-Routern. Hier gibt es mehrere Ansätze wie TURN (Traversal Using Relay NAT) \cite{turn08}, ICE (Interactive Connectivity Establishment) \cite{ice08} und STUN (Simple Traversal of User Datagram Protocol Through Network Adress Translators) \cite{stun03}. 
%Diese Protokolle helfen vor allem Peer-to-Peer Protokollfamilien, die durch NATs in ihrer Funktionsweise behindert werden. Beispiele solcher Protokolle sind generell alle Peer-to-Peer Protokolle die Multimediakommunikation, Datenaustausch oder Spielen ermöglichen. 

Unter STUN versteht man ein einfaches Protokoll, das es erlaubt Anwendungen festzustellen, ob sie sich hinter einer Firewall oder einem Router mit NAT (Network Adress Translator) befinden und um welche Kategorie von Router es sich handelt. Ebenso ist es mit STUN möglich die öffentliche IP Adresse eines Computers hinter einem NAT herauszufinden. 

Die typische STUN-Konfiguration beinhaltet einen STUN-Client, der in einem privaten Netzwerk beheimatet ist. Dieses Netzwerk wird mit dem Internet durch einen NAT verbunden. Ein weiteres privates Netzwerk, das ebenfalls durch einen NAT verbunden ist, beheimatet einen weiteren STUN-Client. Der STUN-Server befindet sich im öffentlichen Internet. Möchte nun eine Client-Anwendung ihre öffentliche IP-Adresse und Port erfahren, auf der sie Daten empfangen kann, sendet der STUN-Client in der Anwendung einen STUN "`\textit{Shared Secret Request}"' an den STUN-Server und dann einen \textit{Binding Request}. Dafür muss dem Client mindestens die Adresse eines öffentlichen STUN-Servers bekannt sein. Ein \textit{Binding Request} wird benutzt, um die Anwesenheit eines NATs festzustellen und um die öffentliche IP-Adresse und Port zu erfahren, die der NAT generiert hat. Vom STUN-Server wird ein solcher Request mit einer \textit{Binding Response} beantwortet, die genau diese Daten zurück an den Client schickt. Erhält nun ein STUN-Client eine \textit{Binding Response}, vergleicht er die IP-Adresse und den Port mit seiner lokalen IP-Adresse und Sendereport und kann so feststellen, ob es sich hinter einem NAT befindet. Nachdem beide Clients ihre öffentlichen IP-Adressen und Port-Paare kennen, sind sie in der Lage direkt miteinander zu kommunizieren. 

\begin{figure}[h]
	\centering
		\includegraphics[width=0.60\textwidth]{grafiken/stun.eps}
	\caption{Ein schematischer Ablauf von STUN}
	\label{fig:stun}
\end{figure}

%Grafik von STUN Transaktion

%\section{Skype}
%\subsection{Registrierung und Login}
%\subsection{Rufsignalisierung und Sprachübertragung}
%\subsection{Technologie von Skype}
%\subsubsection{Verbindungsstruktur}
%\subsubsection{Sicherheit}
%\subsubsection{Konferenzen}